"use strict";

var _babelHelpers = require("babel-runtime/helpers")["default"];
var _core = require("babel-runtime/core-js")["default"];
var _require = require("layer");

var Layer = _require.Layer;
var _require2 = require("utils");

var accessors = _require2.accessors;
var uniqueId = _require2.uniqueId;
var Segment = (function (Layer) {
  function Segment() {
    _babelHelpers.classCallCheck(this, Segment);

    _babelHelpers.get(_core.Object.getPrototypeOf(Segment.prototype), "constructor", this).call(this);
    // set layer defaults
    this.params({
      type: "segment",
      opacity: 1,
      edits: ["x", "y", "width", "height"],
      handlerWidth: 2,
      handlerOpacity: 0
    });

    this.__minWidth = 1;

    // initialize data accessors
    this.y(function (d) {
      var v = arguments[1] === undefined ? null : arguments[1];
      if (v === null) return +d.y || 0;
      d.y = +v;
    });

    this.height(function (d) {
      var v = arguments[1] === undefined ? null : arguments[1];
      if (v === null) return +d.height || 1;
      d.height = +v;
    });

    this.duration(function (d) {
      var v = arguments[1] === undefined ? null : arguments[1];
      if (v === null) return +d.duration || 1;
      d.duration = +v;
    });

    this.start(function (d) {
      var v = arguments[1] === undefined ? null : arguments[1];
      if (v === null) return +d.start || 0;
      d.start = +v;
    });

    this.color(function (d) {
      var v = arguments[1] === undefined ? null : arguments[1];
      if (v === null) return d.color ? d.color + "" : "#000000";
      d.color = v + "";
    });

    this.opacity(function (d) {
      var v = arguments[1] === undefined ? null : arguments[1];
      if (v === null) return d.opacity;
      d.opacity = v + "";
    });
  }

  _babelHelpers.inherits(Segment, Layer);

  _babelHelpers.prototypeProperties(Segment, null, {
    getAccessors: {

      // @NOTE add some caching system ?
      value: function getAccessors() {
        var _this = this;
        // reverse yScale to have logical sizes
        // only y is problematic this way
        var xScale = this.base.xScale;
        var yScale = this.yScale.copy();
        yScale.range(yScale.range().slice(0).reverse());
        var height = yScale.range()[1];
        var minDomain = xScale.domain()[0];

        var _x = this.start();
        var _y = this.y();
        var _w = this.duration();
        var _h = this.height();

        var _color = this.color();
        var _opacity = this.opacity();

        // define accesors
        var x = function (d) {
          return xScale(_x(d));
        };
        var w = function (d) {
          var width = xScale(minDomain + _w(d));
          return width < 0 ? 0 : width;
        };
        var h = function (d) {
          return yScale(_h(d));
        };
        var y = function (d) {
          return height - h(d) - yScale(_y(d));
        };

        var color = function (d) {
          return _color(d);
        };
        var opacity = function (d) {
          return _opacity(d) || _this.param("opacity");
        };

        var _handlerWidth = parseInt(this.param("handlerWidth"), 10);
        var _halfHandler = _handlerWidth * 0.5;

        // handler position
        var rhx = function (d) {
          var width = w(d);

          return width < _handlerWidth * 2 ? _handlerWidth + _this.__minWidth : width - _halfHandler;
        };

        return { w: w, h: h, x: x, y: y, color: color, opacity: opacity, xScale: xScale, yScale: yScale, rhx: rhx };
      },
      writable: true,
      configurable: true
    },
    update: {
      value: function update(data) {
        _babelHelpers.get(_core.Object.getPrototypeOf(Segment.prototype), "update", this).call(this, data);

        this.items = this.g.selectAll("." + this.param("unitClass")).data(this.data(), this.dataKey());

        var sel = this.items.enter().append("g").classed("item", true).classed(this.param("unitClass"), true);

        sel.append("rect");

        if (this.param("interactions").editable) {
          sel.append("line").attr("class", "handle left").attr("stroke-width", this.param("handlerWidth")).attr("stroke-opacity", this.param("handlerOpacity"));

          sel.append("line").attr("class", "handle right").attr("stroke-width", this.param("handlerWidth")).attr("stroke-opacity", this.param("handlerOpacity"));
        }

        this.items.exit().remove();
      },
      writable: true,
      configurable: true
    },
    draw: {
      value: function draw() {
        var el = arguments[0] === undefined ? null : arguments[0];
        el = el || this.items;

        var accessors = this.getAccessors();

        el.attr("transform", function (d) {
          return "translate(" + accessors.x(d) + ", " + accessors.y(d) + ")";
        });

        el.selectAll("rect").attr("x", 0).attr("y", 0).attr("width", accessors.w).attr("height", accessors.h).attr("fill", accessors.color).attr("fill-opacity", accessors.opacity);

        if (!!this.each()) {
          el.each(this.each());
        }

        if (this.param("interactions").editable) {
          var _handlerWidth = parseInt(this.param("handlerWidth"), 10);
          var _halfHandler = _handlerWidth * 0.5;

          el.selectAll(".handle.left").attr("x1", _halfHandler).attr("x2", _halfHandler).attr("y1", 0).attr("y2", accessors.h).style("stroke", accessors.color);

          el.selectAll(".handle.right").attr("x1", 0).attr("x2", 0).attr("y1", 0).attr("y2", accessors.h).attr("transform", function (d) {
            return "translate(" + accessors.rhx(d) + ", 0)";
          }).style("stroke", accessors.color);
        }
      },
      writable: true,
      configurable: true
    },
    xZoom: {
      value: function xZoom(val) {
        this.draw();
      },
      writable: true,
      configurable: true
    },
    handleBrush: {

      // logic performed to select an item from the brush
      value: function handleBrush(extent, e) {},
      writable: true,
      configurable: true
    },
    handleDrag: {
      value: function handleDrag(item, e) {
        if (item === null) {
          return;
        }

        var classList = e.target.classList;
        var mode = "move";
        // if the target is an handler
        if (classList.contains("left")) {
          mode = "resizeLeft";
        }
        if (classList.contains("right")) {
          mode = "resizeRight";
        }

        this[mode](item, e.originalEvent.dx, e.originalEvent.dy);
      },
      writable: true,
      configurable: true
    },
    move: {
      value: function move(item, dx, dy) {
        item = this.d3.select(item);
        var datum = item.datum();
        // define constrains
        var constrains = this.param("edits");
        var canX = !! ~constrains.indexOf("x");
        var canY = !! ~constrains.indexOf("y");
        // early return if cannot edit x and y
        if (!canX && !canY) {
          return;
        }
        // else lock the corresponding axis
        if (!canX) {
          dx = 0;
        }
        if (!canY) {
          dy = 0;
        }

        var accessors = this.getAccessors();

        var xScale = accessors.xScale;
        var yScale = accessors.yScale;
        var xRange = xScale.range();
        var yRange = yScale.range();

        var x = accessors.x(datum);
        var w = accessors.w(datum);
        var h = accessors.h(datum);
        var y = yScale(this.y()(datum));

        // handle x position - lock to boundaries
        var targetX = x + dx;
        if (targetX >= xRange[0] && targetX + w <= xRange[1]) {
          x = targetX;
        } else if (targetX < xRange[0]) {
          x = xRange[0];
        } else if (targetX + w > xRange[1]) {
          x = xRange[1] - w;
        }

        // handle y position - lock to boundaries
        var targetY = y - dy;
        var yDisplayed = yRange[1] - h - targetY;

        if (yDisplayed >= yRange[0] && yDisplayed + h <= yRange[1]) {
          y = targetY;
        } else if (yDisplayed < yRange[0]) {
          y = yRange[1] - h;
        } else if (yDisplayed + h > yRange[1]) {
          y = yRange[0];
        }

        var xValue = xScale.invert(x);
        var yValue = yScale.invert(y);

        this.start()(datum, xValue);
        this.y()(datum, yValue);

        this.draw(item);
      },
      writable: true,
      configurable: true
    },
    resizeLeft: {
      value: function resizeLeft(item, dx, dy) {
        item = this.d3.select(item);
        var datum = item.datum();

        var constrains = this.param("edits");
        var canW = !! ~constrains.indexOf("width");
        // early return if cannot edit
        if (!canW) {
          return;
        }

        var accessors = this.getAccessors();
        var xRange = accessors.xScale.range();

        var x = accessors.x(datum);
        var w = accessors.w(datum);

        var targetX = x + dx;
        var targetW = w - dx;

        if (targetX >= xRange[0] && targetW >= this.__minWidth) {
          x = targetX;
          w = targetW;
        }

        var xValue = accessors.xScale.invert(x);
        var minDomain = accessors.xScale.domain()[0];
        var wValue = accessors.xScale.invert(w) - minDomain;

        this.start()(datum, xValue);
        this.duration()(datum, wValue);

        this.draw(item);
      },
      writable: true,
      configurable: true
    },
    resizeRight: {
      value: function resizeRight(item, dx, dy) {
        item = this.d3.select(item);
        var datum = item.datum();

        var constrains = this.param("edits");
        var canW = !! ~constrains.indexOf("width");
        // early return if cannot edit
        if (!canW) {
          return;
        }

        var accessors = this.getAccessors();
        var xRange = accessors.xScale.range();

        var x = accessors.x(datum);
        var w = accessors.w(datum);

        var targetW = w + dx;

        if (targetW >= this.__minWidth && x + targetW <= xRange[1]) {
          w = targetW;
        }

        var minDomain = accessors.xScale.domain()[0];
        var wValue = accessors.xScale.invert(w) - minDomain;
        this.duration()(datum, wValue);

        this.draw(item);
      },
      writable: true,
      configurable: true
    }
  });

  return Segment;
})(Layer);

// add and initialize our accessors
accessors.getFunction(Segment.prototype, ["y", "width", "color", "height", "duration", "start", "sortIndex", "opacity"]);

function factory() {
  return new Segment();
}
factory.Segment = Segment;

module.exports = factory;
// brushItem(extent, mode) {
/*
mode = mode || 'xy'; // default tries to match both
 var modeX = mode.indexOf('x') >= 0;
var modeY = mode.indexOf('y') >= 0;
var matchX = false, matchY = false;
 // data mappers
var start = this.start();
var duration = this.duration();
var y = this.y();
var height = this.height();
 this.g.selectAll('.selectable').classed('selected', (d, i) => {
  // var offsetTop = (that.top() || 0) + (that.base.margin().top || 0);
  // var offsetLeft = (that.left || 0) + (that.base.margin().left || 0);
   // X match
  if (modeX) {
    var x1 = start(d);
    var x2 = x1 + duration(d);
    //            begining sel               end sel
    var matchX1 = extent[0][0] <= x1 && x2 < extent[1][0];
    var matchX2 = extent[0][0] <= x2 && x1 < extent[1][0];
     matchX = (matchX1 || matchX2);
  } else {
    matchX = true;
  }
   // Y match
  if (modeY) {
    var y1 = y(d);
    var y2 = y1 + height(d);
    //            begining sel               end sel
    var matchY1 = extent[0][1] <= y1 && y2 < extent[1][1];
    var matchY2 = extent[0][1] <= y2 && y1 <= extent[1][1];
     matchY = (matchY1 || matchY2);
  } else {
    matchY = true;
  }
   return matchX && matchY;
});
*/

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vc2VnbWVudC5lczYuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDOzs7O2VBRUcsT0FBTyxDQUFDLE9BQU8sQ0FBQzs7SUFBMUIsS0FBSyxZQUFMLEtBQUs7Z0JBQ21CLE9BQU8sQ0FBQyxPQUFPLENBQUM7O0lBQXhDLFNBQVMsYUFBVCxTQUFTO0lBQUUsUUFBUSxhQUFSLFFBQVE7SUFFbkIsT0FBTyxjQUFTLEtBQUs7QUFFZCxXQUZQLE9BQU87dUNBQVAsT0FBTzs7QUFHVCxrREFIRSxPQUFPLDZDQUdEOztBQUVSLFFBQUksQ0FBQyxNQUFNLENBQUM7QUFDVixVQUFJLEVBQUUsU0FBUztBQUNmLGFBQU8sRUFBRSxDQUFDO0FBQ1YsV0FBSyxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxPQUFPLEVBQUUsUUFBUSxDQUFDO0FBQ3BDLGtCQUFZLEVBQUUsQ0FBQztBQUNmLG9CQUFjLEVBQUUsQ0FBQztLQUNsQixDQUFDLENBQUM7O0FBRUgsUUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUM7OztBQUdwQixRQUFJLENBQUMsQ0FBQyxDQUFDLFVBQVMsQ0FBQyxFQUFZO1VBQVYsQ0FBQyxnQ0FBRyxJQUFJO0FBQ3pCLFVBQUksQ0FBQyxLQUFLLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDakMsT0FBQyxDQUFDLENBQUMsR0FBSSxDQUFDLENBQUMsQUFBQyxDQUFDO0tBQ1osQ0FBQyxDQUFDOztBQUVILFFBQUksQ0FBQyxNQUFNLENBQUMsVUFBUyxDQUFDLEVBQVk7VUFBVixDQUFDLGdDQUFHLElBQUk7QUFDOUIsVUFBSSxDQUFDLEtBQUssSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxJQUFJLENBQUMsQ0FBQztBQUN0QyxPQUFDLENBQUMsTUFBTSxHQUFJLENBQUMsQ0FBQyxBQUFDLENBQUM7S0FDakIsQ0FBQyxDQUFDOztBQUVILFFBQUksQ0FBQyxRQUFRLENBQUMsVUFBUyxDQUFDLEVBQVk7VUFBVixDQUFDLGdDQUFHLElBQUk7QUFDaEMsVUFBSSxDQUFDLEtBQUssSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsUUFBUSxJQUFJLENBQUMsQ0FBQztBQUN4QyxPQUFDLENBQUMsUUFBUSxHQUFJLENBQUMsQ0FBQyxBQUFDLENBQUM7S0FDbkIsQ0FBQyxDQUFDOztBQUVILFFBQUksQ0FBQyxLQUFLLENBQUMsVUFBUyxDQUFDLEVBQVk7VUFBVixDQUFDLGdDQUFHLElBQUk7QUFDN0IsVUFBSSxDQUFDLEtBQUssSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQztBQUNyQyxPQUFDLENBQUMsS0FBSyxHQUFJLENBQUMsQ0FBQyxBQUFDLENBQUM7S0FDaEIsQ0FBQyxDQUFDOztBQUVILFFBQUksQ0FBQyxLQUFLLENBQUMsVUFBUyxDQUFDLEVBQVk7VUFBVixDQUFDLGdDQUFHLElBQUk7QUFDN0IsVUFBSSxDQUFDLEtBQUssSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSyxHQUFHLEVBQUUsR0FBRyxTQUFTLENBQUM7QUFDMUQsT0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDO0tBQ2xCLENBQUMsQ0FBQzs7QUFFSCxRQUFJLENBQUMsT0FBTyxDQUFDLFVBQVMsQ0FBQyxFQUFZO1VBQVYsQ0FBQyxnQ0FBRyxJQUFJO0FBQy9CLFVBQUksQ0FBQyxLQUFLLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUM7QUFDakMsT0FBQyxDQUFDLE9BQU8sR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDO0tBQ3BCLENBQUMsQ0FBQztHQUNKOzt5QkE3Q0csT0FBTyxFQUFTLEtBQUs7O29DQUFyQixPQUFPO0FBZ0RYLGdCQUFZOzs7YUFBQSx3QkFBRzs7OztBQUdiLFlBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO0FBQzlCLFlBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDaEMsY0FBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7QUFDaEQsWUFBSSxNQUFNLEdBQUcsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQy9CLFlBQUksU0FBUyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQzs7QUFFbkMsWUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO0FBQ3RCLFlBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQztBQUNsQixZQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7QUFDekIsWUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDOztBQUV2QixZQUFJLE1BQU0sR0FBTSxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7QUFDN0IsWUFBSSxRQUFRLEdBQUksSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDOzs7QUFHL0IsWUFBSSxDQUFDLEdBQUcsVUFBQyxDQUFDLEVBQUs7QUFBRSxpQkFBTyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FBRSxDQUFDO0FBQ3pDLFlBQUksQ0FBQyxHQUFHLFVBQUMsQ0FBQyxFQUFLO0FBQ2IsY0FBSSxLQUFLLEdBQUcsTUFBTSxDQUFDLFNBQVMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN0QyxpQkFBTyxLQUFLLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUM7U0FDOUIsQ0FBQztBQUNGLFlBQUksQ0FBQyxHQUFHLFVBQUMsQ0FBQyxFQUFLO0FBQUUsaUJBQU8sTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQUUsQ0FBQztBQUN6QyxZQUFJLENBQUMsR0FBRyxVQUFDLENBQUMsRUFBSztBQUFFLGlCQUFPLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQUUsQ0FBQzs7QUFFekQsWUFBSSxLQUFLLEdBQUcsVUFBQyxDQUFDLEVBQUs7QUFBRSxpQkFBTyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FBRSxDQUFDO0FBQ3pDLFlBQUksT0FBTyxHQUFHLFVBQUMsQ0FBQyxFQUFLO0FBQUUsaUJBQVEsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLE1BQUssS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFFO1NBQUUsQ0FBQzs7QUFFeEUsWUFBSSxhQUFhLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFDN0QsWUFBSSxZQUFZLEdBQUcsYUFBYSxHQUFHLEdBQUcsQ0FBQzs7O0FBR3ZDLFlBQUksR0FBRyxHQUFHLFVBQUMsQ0FBQyxFQUFLO0FBQ2YsY0FBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDOztBQUVqQixpQkFBTyxBQUFDLEtBQUssR0FBSSxhQUFhLEdBQUcsQ0FBQyxBQUFDLEdBQ2pDLGFBQWEsR0FBRyxNQUFLLFVBQVUsR0FBRyxLQUFLLEdBQUcsWUFBWSxDQUFDO1NBQzFELENBQUM7O0FBRUYsZUFBTyxFQUFFLENBQUMsRUFBRCxDQUFDLEVBQUUsQ0FBQyxFQUFELENBQUMsRUFBRSxDQUFDLEVBQUQsQ0FBQyxFQUFFLENBQUMsRUFBRCxDQUFDLEVBQUUsS0FBSyxFQUFMLEtBQUssRUFBRSxPQUFPLEVBQVAsT0FBTyxFQUFFLE1BQU0sRUFBTixNQUFNLEVBQUUsTUFBTSxFQUFOLE1BQU0sRUFBRSxHQUFHLEVBQUgsR0FBRyxFQUFFLENBQUM7T0FDNUQ7Ozs7QUFFRCxVQUFNO2FBQUEsZ0JBQUMsSUFBSSxFQUFFO0FBQ1gsc0RBNUZFLE9BQU8sd0NBNEZJLElBQUksRUFBRTs7QUFFbkIsWUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUN6RCxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxFQUFFLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDOztBQUVyQyxZQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUN6QixNQUFNLENBQUMsR0FBRyxDQUFDLENBQ1gsT0FBTyxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FDckIsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7O0FBRTFDLFdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7O0FBRW5CLFlBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsQ0FBQyxRQUFRLEVBQUU7QUFDdkMsYUFBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FDZixJQUFJLENBQUMsT0FBTyxFQUFFLGFBQWEsQ0FBQyxDQUM1QixJQUFJLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FDaEQsSUFBSSxDQUFDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDOztBQUV4RCxhQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUNmLElBQUksQ0FBQyxPQUFPLEVBQUUsY0FBYyxDQUFDLENBQzdCLElBQUksQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUNoRCxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7U0FDekQ7O0FBRUQsWUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQztPQUM1Qjs7OztBQUVELFFBQUk7YUFBQSxnQkFBWTtZQUFYLEVBQUUsZ0NBQUcsSUFBSTtBQUNaLFVBQUUsR0FBRyxFQUFFLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQzs7QUFFdEIsWUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDOztBQUVwQyxVQUFFLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxVQUFDLENBQUMsRUFBSztBQUMxQixpQkFBTyxZQUFZLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUM7U0FDcEUsQ0FBQyxDQUFDOztBQUVILFVBQUUsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQ2pCLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQ1osSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FDWixJQUFJLENBQUMsT0FBTyxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FDMUIsSUFBSSxDQUFDLFFBQVEsRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQzNCLElBQUksQ0FBQyxNQUFNLEVBQUUsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUM3QixJQUFJLENBQUMsY0FBYyxFQUFFLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQzs7QUFFM0MsWUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxFQUFFO0FBQUUsWUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztTQUFFOztBQUU1QyxZQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUMsUUFBUSxFQUFFO0FBRXZDLGNBQUksYUFBYSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0FBQzdELGNBQUksWUFBWSxHQUFHLGFBQWEsR0FBRyxHQUFHLENBQUM7O0FBRXZDLFlBQUUsQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLENBQ3pCLElBQUksQ0FBQyxJQUFJLEVBQUUsWUFBWSxDQUFDLENBQ3hCLElBQUksQ0FBQyxJQUFJLEVBQUUsWUFBWSxDQUFDLENBQ3hCLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQ2IsSUFBSSxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQ3ZCLEtBQUssQ0FBQyxRQUFRLEVBQUUsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDOztBQUVwQyxZQUFFLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxDQUMxQixJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUNiLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQ2IsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsQ0FDYixJQUFJLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FDdkIsSUFBSSxDQUFDLFdBQVcsRUFBRSxVQUFDLENBQUMsRUFBSztBQUN4QixtQkFBTyxZQUFZLEdBQUcsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUM7V0FDakQsQ0FBQyxDQUNELEtBQUssQ0FBQyxRQUFRLEVBQUUsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ3JDO09BQ0Y7Ozs7QUFFRCxTQUFLO2FBQUEsZUFBQyxHQUFHLEVBQUU7QUFDVCxZQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7T0FDYjs7OztBQUdELGVBQVc7OzthQUFBLHFCQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFnRHRCOzs7O0FBRUQsY0FBVTthQUFBLG9CQUFDLElBQUksRUFBRSxDQUFDLEVBQUU7QUFDbEIsWUFBSSxJQUFJLEtBQUssSUFBSSxFQUFFO0FBQUUsaUJBQU87U0FBRTs7QUFFOUIsWUFBSSxTQUFTLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUM7QUFDbkMsWUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDOztBQUVsQixZQUFJLFNBQVMsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUU7QUFBRSxjQUFJLEdBQUcsWUFBWSxDQUFDO1NBQUU7QUFDeEQsWUFBSSxTQUFTLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFO0FBQUUsY0FBSSxHQUFHLGFBQWEsQ0FBQztTQUFFOztBQUUxRCxZQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxhQUFhLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7T0FDMUQ7Ozs7QUFFRCxRQUFJO2FBQUEsY0FBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRTtBQUNqQixZQUFJLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDNUIsWUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDOztBQUV6QixZQUFJLFVBQVUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQ3JDLFlBQUksSUFBSSxHQUFHLENBQUMsRUFBQyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDdEMsWUFBSSxJQUFJLEdBQUcsQ0FBQyxFQUFDLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQzs7QUFFdEMsWUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksRUFBRTtBQUFFLGlCQUFPO1NBQUU7O0FBRS9CLFlBQUksQ0FBQyxJQUFJLEVBQUU7QUFBRSxZQUFFLEdBQUcsQ0FBQyxDQUFDO1NBQUU7QUFDdEIsWUFBSSxDQUFDLElBQUksRUFBRTtBQUFFLFlBQUUsR0FBRyxDQUFDLENBQUM7U0FBRTs7QUFFdEIsWUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDOztBQUVwQyxZQUFJLE1BQU0sR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDO0FBQzlCLFlBQUksTUFBTSxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUM7QUFDOUIsWUFBSSxNQUFNLEdBQUcsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO0FBQzVCLFlBQUksTUFBTSxHQUFHLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQzs7QUFFNUIsWUFBSSxDQUFDLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUMzQixZQUFJLENBQUMsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQzNCLFlBQUksQ0FBQyxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDM0IsWUFBSSxDQUFDLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDOzs7QUFHaEMsWUFBSSxPQUFPLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztBQUNyQixZQUFJLE9BQU8sSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQUFBQyxPQUFPLEdBQUcsQ0FBQyxJQUFLLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRTtBQUN0RCxXQUFDLEdBQUcsT0FBTyxDQUFDO1NBQ2IsTUFBTSxJQUFJLE9BQU8sR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUU7QUFDOUIsV0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNmLE1BQU0sSUFBSSxBQUFDLE9BQU8sR0FBRyxDQUFDLEdBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFO0FBQ3BDLFdBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQ25COzs7QUFHRCxZQUFJLE9BQU8sR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDO0FBQ3JCLFlBQUksVUFBVSxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsT0FBTyxDQUFDOztBQUV6QyxZQUFJLFVBQVUsSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLElBQUksQUFBQyxVQUFVLEdBQUcsQ0FBQyxJQUFLLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRTtBQUM1RCxXQUFDLEdBQUcsT0FBTyxDQUFDO1NBQ2IsTUFBTSxJQUFJLFVBQVUsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUU7QUFDakMsV0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDbkIsTUFBTSxJQUFJLEFBQUMsVUFBVSxHQUFHLENBQUMsR0FBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUU7QUFDdkMsV0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNmOztBQUVELFlBQUksTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDOUIsWUFBSSxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQzs7QUFFOUIsWUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQztBQUM1QixZQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDOztBQUV4QixZQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO09BQ2pCOzs7O0FBRUQsY0FBVTthQUFBLG9CQUFDLElBQUksRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFO0FBQ3ZCLFlBQUksR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUM1QixZQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7O0FBRXpCLFlBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDckMsWUFBSSxJQUFJLEdBQUcsQ0FBQyxFQUFDLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQzs7QUFFMUMsWUFBSSxDQUFDLElBQUksRUFBRTtBQUFFLGlCQUFPO1NBQUU7O0FBRXRCLFlBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztBQUNwQyxZQUFJLE1BQU0sR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDOztBQUV0QyxZQUFJLENBQUMsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQzNCLFlBQUksQ0FBQyxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7O0FBRTNCLFlBQUksT0FBTyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUM7QUFDckIsWUFBSSxPQUFPLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQzs7QUFFckIsWUFBSSxPQUFPLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLE9BQU8sSUFBSSxJQUFJLENBQUMsVUFBVSxFQUFFO0FBQ3RELFdBQUMsR0FBRyxPQUFPLENBQUM7QUFDWixXQUFDLEdBQUcsT0FBTyxDQUFDO1NBQ2I7O0FBRUQsWUFBSSxNQUFNLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDeEMsWUFBSSxTQUFTLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUM3QyxZQUFJLE1BQU0sR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxTQUFTLENBQUM7O0FBRXBELFlBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDNUIsWUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsQ0FBQzs7QUFFL0IsWUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztPQUNqQjs7OztBQUVELGVBQVc7YUFBQSxxQkFBQyxJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRTtBQUN4QixZQUFJLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDNUIsWUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDOztBQUV6QixZQUFJLFVBQVUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQ3JDLFlBQUksSUFBSSxHQUFHLENBQUMsRUFBQyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7O0FBRTFDLFlBQUksQ0FBQyxJQUFJLEVBQUU7QUFBRSxpQkFBTztTQUFFOztBQUV0QixZQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsWUFBWSxFQUFFLENBQUM7QUFDcEMsWUFBSSxNQUFNLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQzs7QUFFdEMsWUFBSSxDQUFDLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUMzQixZQUFJLENBQUMsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDOztBQUUzQixZQUFJLE9BQU8sR0FBRyxDQUFDLEdBQUcsRUFBRSxDQUFDOztBQUVyQixZQUFJLE9BQU8sSUFBSSxJQUFJLENBQUMsVUFBVSxJQUFJLEFBQUMsQ0FBQyxHQUFHLE9BQU8sSUFBSyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUU7QUFDNUQsV0FBQyxHQUFHLE9BQU8sQ0FBQztTQUNiOztBQUVELFlBQUksU0FBUyxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDN0MsWUFBSSxNQUFNLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUcsU0FBUyxDQUFDO0FBQ3BELFlBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7O0FBRS9CLFlBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7T0FDakI7Ozs7OztTQXhWRyxPQUFPO0dBQVMsS0FBSzs7O0FBNlYzQixTQUFTLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FDdkMsR0FBRyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLFNBQVMsQ0FDN0UsQ0FBQyxDQUFDOztBQUVILFNBQVMsT0FBTyxHQUFHO0FBQUUsU0FBTyxJQUFJLE9BQU8sRUFBRSxDQUFDO0NBQUU7QUFDNUMsT0FBTyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7O0FBRTFCLE1BQU0sQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDIiwiZmlsZSI6Ii4vc2VnbWVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxubGV0IHsgTGF5ZXIgfSA9IHJlcXVpcmUoJ2xheWVyJyk7XG5sZXQgeyBhY2Nlc3NvcnMsIHVuaXF1ZUlkIH0gPSByZXF1aXJlKCd1dGlscycpO1xuXG5jbGFzcyBTZWdtZW50IGV4dGVuZHMgTGF5ZXIge1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gICAgLy8gc2V0IGxheWVyIGRlZmF1bHRzXG4gICAgdGhpcy5wYXJhbXMoe1xuICAgICAgdHlwZTogJ3NlZ21lbnQnLFxuICAgICAgb3BhY2l0eTogMSxcbiAgICAgIGVkaXRzOiBbJ3gnLCAneScsICd3aWR0aCcsICdoZWlnaHQnXSxcbiAgICAgIGhhbmRsZXJXaWR0aDogMixcbiAgICAgIGhhbmRsZXJPcGFjaXR5OiAwXG4gICAgfSk7XG5cbiAgICB0aGlzLl9fbWluV2lkdGggPSAxO1xuXG4gICAgLy8gaW5pdGlhbGl6ZSBkYXRhIGFjY2Vzc29yc1xuICAgIHRoaXMueShmdW5jdGlvbihkLCB2ID0gbnVsbCkge1xuICAgICAgaWYgKHYgPT09IG51bGwpIHJldHVybiArZC55IHx8wqAwO1xuICAgICAgZC55ID0gKCt2KTtcbiAgICB9KTtcblxuICAgIHRoaXMuaGVpZ2h0KGZ1bmN0aW9uKGQsIHYgPSBudWxsKSB7XG4gICAgICBpZiAodiA9PT0gbnVsbCkgcmV0dXJuICtkLmhlaWdodCB8fMKgMTtcbiAgICAgIGQuaGVpZ2h0ID0gKCt2KTtcbiAgICB9KTtcblxuICAgIHRoaXMuZHVyYXRpb24oZnVuY3Rpb24oZCwgdiA9IG51bGwpIHtcbiAgICAgIGlmICh2ID09PSBudWxsKSByZXR1cm4gK2QuZHVyYXRpb24gfHzCoDE7XG4gICAgICBkLmR1cmF0aW9uID0gKCt2KTtcbiAgICB9KTtcblxuICAgIHRoaXMuc3RhcnQoZnVuY3Rpb24oZCwgdiA9IG51bGwpIHtcbiAgICAgIGlmICh2ID09PSBudWxsKSByZXR1cm4gK2Quc3RhcnQgfHwgMDtcbiAgICAgIGQuc3RhcnQgPSAoK3YpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5jb2xvcihmdW5jdGlvbihkLCB2ID0gbnVsbCkge1xuICAgICAgaWYgKHYgPT09IG51bGwpIHJldHVybiBkLmNvbG9yID8gZC5jb2xvciArICcnIDogJyMwMDAwMDAnO1xuICAgICAgZC5jb2xvciA9IHYgKyAnJztcbiAgICB9KTtcblxuICAgIHRoaXMub3BhY2l0eShmdW5jdGlvbihkLCB2ID0gbnVsbCkge1xuICAgICAgaWYgKHYgPT09IG51bGwpIHJldHVybiBkLm9wYWNpdHk7XG4gICAgICBkLm9wYWNpdHkgPSB2ICsgJyc7XG4gICAgfSk7XG4gIH1cblxuICAvLyBATk9URSBhZGQgc29tZSBjYWNoaW5nIHN5c3RlbSA/XG4gIGdldEFjY2Vzc29ycygpIHtcbiAgICAvLyByZXZlcnNlIHlTY2FsZSB0byBoYXZlIGxvZ2ljYWwgc2l6ZXNcbiAgICAvLyBvbmx5IHkgaXMgcHJvYmxlbWF0aWMgdGhpcyB3YXlcbiAgICB2YXIgeFNjYWxlID0gdGhpcy5iYXNlLnhTY2FsZTtcbiAgICB2YXIgeVNjYWxlID0gdGhpcy55U2NhbGUuY29weSgpO1xuICAgIHlTY2FsZS5yYW5nZSh5U2NhbGUucmFuZ2UoKS5zbGljZSgwKS5yZXZlcnNlKCkpO1xuICAgIHZhciBoZWlnaHQgPSB5U2NhbGUucmFuZ2UoKVsxXTtcbiAgICB2YXIgbWluRG9tYWluID0geFNjYWxlLmRvbWFpbigpWzBdO1xuXG4gICAgdmFyIF94ID0gdGhpcy5zdGFydCgpO1xuICAgIHZhciBfeSA9IHRoaXMueSgpO1xuICAgIHZhciBfdyA9IHRoaXMuZHVyYXRpb24oKTtcbiAgICB2YXIgX2ggPSB0aGlzLmhlaWdodCgpO1xuXG4gICAgdmFyIF9jb2xvciAgICA9IHRoaXMuY29sb3IoKTtcbiAgICB2YXIgX29wYWNpdHkgID0gdGhpcy5vcGFjaXR5KCk7XG5cbiAgICAvLyBkZWZpbmUgYWNjZXNvcnNcbiAgICB2YXIgeCA9IChkKSA9PiB7IHJldHVybiB4U2NhbGUoX3goZCkpOyB9O1xuICAgIHZhciB3ID0gKGQpID0+IHtcbiAgICAgIHZhciB3aWR0aCA9IHhTY2FsZShtaW5Eb21haW4gKyBfdyhkKSk7XG4gICAgICByZXR1cm4gd2lkdGggPCAwID8gMCA6IHdpZHRoO1xuICAgIH07XG4gICAgdmFyIGggPSAoZCkgPT4geyByZXR1cm4geVNjYWxlKF9oKGQpKTsgfTtcbiAgICB2YXIgeSA9IChkKSA9PiB7IHJldHVybiBoZWlnaHQgLSBoKGQpIC0geVNjYWxlKF95KGQpKTsgfTtcblxuICAgIHZhciBjb2xvciA9IChkKSA9PiB7IHJldHVybiBfY29sb3IoZCk7IH07XG4gICAgdmFyIG9wYWNpdHkgPSAoZCkgPT4geyByZXR1cm4gKF9vcGFjaXR5KGQpIHx8wqB0aGlzLnBhcmFtKCdvcGFjaXR5JykpOyB9O1xuXG4gICAgdmFyIF9oYW5kbGVyV2lkdGggPSBwYXJzZUludCh0aGlzLnBhcmFtKCdoYW5kbGVyV2lkdGgnKSwgMTApO1xuICAgIHZhciBfaGFsZkhhbmRsZXIgPSBfaGFuZGxlcldpZHRoICogMC41O1xuXG4gICAgLy8gaGFuZGxlciBwb3NpdGlvblxuICAgIHZhciByaHggPSAoZCkgPT4ge1xuICAgICAgbGV0IHdpZHRoID0gdyhkKTtcblxuICAgICAgcmV0dXJuICh3aWR0aCA8IChfaGFuZGxlcldpZHRoICogMikpID9cbiAgICAgICAgX2hhbmRsZXJXaWR0aCArIHRoaXMuX19taW5XaWR0aCA6IHdpZHRoIC0gX2hhbGZIYW5kbGVyO1xuICAgIH07XG5cbiAgICByZXR1cm4geyB3LCBoLCB4LCB5LCBjb2xvciwgb3BhY2l0eSwgeFNjYWxlLCB5U2NhbGUsIHJoeCB9O1xuICB9XG5cbiAgdXBkYXRlKGRhdGEpIHtcbiAgICBzdXBlci51cGRhdGUoZGF0YSk7XG5cbiAgICB0aGlzLml0ZW1zID0gdGhpcy5nLnNlbGVjdEFsbCgnLicgKyB0aGlzLnBhcmFtKCd1bml0Q2xhc3MnKSlcbiAgICAgIC5kYXRhKHRoaXMuZGF0YSgpLCB0aGlzLmRhdGFLZXkoKSk7XG5cbiAgICB2YXIgc2VsID0gdGhpcy5pdGVtcy5lbnRlcigpXG4gICAgICAuYXBwZW5kKCdnJylcbiAgICAgIC5jbGFzc2VkKCdpdGVtJywgdHJ1ZSlcbiAgICAgIC5jbGFzc2VkKHRoaXMucGFyYW0oJ3VuaXRDbGFzcycpLCB0cnVlKTtcblxuICAgIHNlbC5hcHBlbmQoJ3JlY3QnKTtcblxuICAgIGlmICh0aGlzLnBhcmFtKCdpbnRlcmFjdGlvbnMnKS5lZGl0YWJsZSkge1xuICAgICAgc2VsLmFwcGVuZCgnbGluZScpXG4gICAgICAgIC5hdHRyKCdjbGFzcycsICdoYW5kbGUgbGVmdCcpXG4gICAgICAgIC5hdHRyKCdzdHJva2Utd2lkdGgnLCB0aGlzLnBhcmFtKCdoYW5kbGVyV2lkdGgnKSlcbiAgICAgICAgLmF0dHIoJ3N0cm9rZS1vcGFjaXR5JywgdGhpcy5wYXJhbSgnaGFuZGxlck9wYWNpdHknKSk7XG5cbiAgICAgIHNlbC5hcHBlbmQoJ2xpbmUnKVxuICAgICAgICAuYXR0cignY2xhc3MnLCAnaGFuZGxlIHJpZ2h0JylcbiAgICAgICAgLmF0dHIoJ3N0cm9rZS13aWR0aCcsIHRoaXMucGFyYW0oJ2hhbmRsZXJXaWR0aCcpKVxuICAgICAgICAuYXR0cignc3Ryb2tlLW9wYWNpdHknLCB0aGlzLnBhcmFtKCdoYW5kbGVyT3BhY2l0eScpKTtcbiAgICB9XG5cbiAgICB0aGlzLml0ZW1zLmV4aXQoKS5yZW1vdmUoKTtcbiAgfVxuXG4gIGRyYXcoZWwgPSBudWxsKSB7XG4gICAgZWwgPSBlbCB8fCB0aGlzLml0ZW1zO1xuXG4gICAgdmFyIGFjY2Vzc29ycyA9IHRoaXMuZ2V0QWNjZXNzb3JzKCk7XG5cbiAgICBlbC5hdHRyKCd0cmFuc2Zvcm0nLCAoZCkgPT4ge1xuICAgICAgcmV0dXJuICd0cmFuc2xhdGUoJyArIGFjY2Vzc29ycy54KGQpICsgJywgJyArIGFjY2Vzc29ycy55KGQpICsgJyknO1xuICAgIH0pO1xuXG4gICAgZWwuc2VsZWN0QWxsKCdyZWN0JylcbiAgICAgIC5hdHRyKCd4JywgMClcbiAgICAgIC5hdHRyKCd5JywgMClcbiAgICAgIC5hdHRyKCd3aWR0aCcsIGFjY2Vzc29ycy53KVxuICAgICAgLmF0dHIoJ2hlaWdodCcsIGFjY2Vzc29ycy5oKVxuICAgICAgLmF0dHIoJ2ZpbGwnLCBhY2Nlc3NvcnMuY29sb3IpXG4gICAgICAuYXR0cignZmlsbC1vcGFjaXR5JywgYWNjZXNzb3JzLm9wYWNpdHkpO1xuXG4gICAgaWYgKCEhdGhpcy5lYWNoKCkpIHsgZWwuZWFjaCh0aGlzLmVhY2goKSk7IH1cblxuICAgIGlmICh0aGlzLnBhcmFtKCdpbnRlcmFjdGlvbnMnKS5lZGl0YWJsZSkge1xuXG4gICAgICB2YXIgX2hhbmRsZXJXaWR0aCA9IHBhcnNlSW50KHRoaXMucGFyYW0oJ2hhbmRsZXJXaWR0aCcpLCAxMCk7XG4gICAgICB2YXIgX2hhbGZIYW5kbGVyID0gX2hhbmRsZXJXaWR0aCAqIDAuNTtcblxuICAgICAgZWwuc2VsZWN0QWxsKCcuaGFuZGxlLmxlZnQnKVxuICAgICAgICAuYXR0cigneDEnLCBfaGFsZkhhbmRsZXIpXG4gICAgICAgIC5hdHRyKCd4MicsIF9oYWxmSGFuZGxlcilcbiAgICAgICAgLmF0dHIoJ3kxJywgMClcbiAgICAgICAgLmF0dHIoJ3kyJywgYWNjZXNzb3JzLmgpXG4gICAgICAgIC5zdHlsZSgnc3Ryb2tlJywgYWNjZXNzb3JzLmNvbG9yKTtcblxuICAgICAgZWwuc2VsZWN0QWxsKCcuaGFuZGxlLnJpZ2h0JylcbiAgICAgICAgLmF0dHIoJ3gxJywgMClcbiAgICAgICAgLmF0dHIoJ3gyJywgMClcbiAgICAgICAgLmF0dHIoJ3kxJywgMClcbiAgICAgICAgLmF0dHIoJ3kyJywgYWNjZXNzb3JzLmgpXG4gICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCAoZCkgPT4ge1xuICAgICAgICAgIHJldHVybiAndHJhbnNsYXRlKCcgKyBhY2Nlc3NvcnMucmh4KGQpICsgJywgMCknO1xuICAgICAgICB9KVxuICAgICAgICAuc3R5bGUoJ3N0cm9rZScsIGFjY2Vzc29ycy5jb2xvcik7XG4gICAgfVxuICB9XG5cbiAgeFpvb20odmFsKSB7XG4gICAgdGhpcy5kcmF3KCk7XG4gIH1cblxuICAvLyBsb2dpYyBwZXJmb3JtZWQgdG8gc2VsZWN0IGFuIGl0ZW0gZnJvbSB0aGUgYnJ1c2hcbiAgaGFuZGxlQnJ1c2goZXh0ZW50LCBlKSB7XG4gIC8vIGJydXNoSXRlbShleHRlbnQsIG1vZGUpIHtcbiAgICAvKlxuICAgIG1vZGUgPSBtb2RlIHx8ICd4eSc7IC8vIGRlZmF1bHQgdHJpZXMgdG8gbWF0Y2ggYm90aFxuXG4gICAgdmFyIG1vZGVYID0gbW9kZS5pbmRleE9mKCd4JykgPj0gMDtcbiAgICB2YXIgbW9kZVkgPSBtb2RlLmluZGV4T2YoJ3knKSA+PSAwO1xuICAgIHZhciBtYXRjaFggPSBmYWxzZSwgbWF0Y2hZID0gZmFsc2U7XG5cbiAgICAvLyBkYXRhIG1hcHBlcnNcbiAgICB2YXIgc3RhcnQgPSB0aGlzLnN0YXJ0KCk7XG4gICAgdmFyIGR1cmF0aW9uID0gdGhpcy5kdXJhdGlvbigpO1xuICAgIHZhciB5ID0gdGhpcy55KCk7XG4gICAgdmFyIGhlaWdodCA9IHRoaXMuaGVpZ2h0KCk7XG5cbiAgICB0aGlzLmcuc2VsZWN0QWxsKCcuc2VsZWN0YWJsZScpLmNsYXNzZWQoJ3NlbGVjdGVkJywgKGQsIGkpID0+IHtcbiAgICAgIC8vIHZhciBvZmZzZXRUb3AgPSAodGhhdC50b3AoKSB8fCAwKSArICh0aGF0LmJhc2UubWFyZ2luKCkudG9wIHx8IDApO1xuICAgICAgLy8gdmFyIG9mZnNldExlZnQgPSAodGhhdC5sZWZ0IHx8IDApICsgKHRoYXQuYmFzZS5tYXJnaW4oKS5sZWZ0IHx8IDApO1xuXG4gICAgICAvLyBYIG1hdGNoXG4gICAgICBpZiAobW9kZVgpIHtcbiAgICAgICAgdmFyIHgxID0gc3RhcnQoZCk7XG4gICAgICAgIHZhciB4MiA9IHgxICsgZHVyYXRpb24oZCk7XG4gICAgICAgIC8vICAgICAgICAgICAgYmVnaW5pbmcgc2VsICAgICAgICAgICAgICAgZW5kIHNlbFxuICAgICAgICB2YXIgbWF0Y2hYMSA9IGV4dGVudFswXVswXSA8PSB4MSAmJiB4MiA8IGV4dGVudFsxXVswXTtcbiAgICAgICAgdmFyIG1hdGNoWDIgPSBleHRlbnRbMF1bMF0gPD0geDIgJiYgeDEgPCBleHRlbnRbMV1bMF07XG5cbiAgICAgICAgbWF0Y2hYID0gKG1hdGNoWDEgfHwgbWF0Y2hYMik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtYXRjaFggPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBZIG1hdGNoXG4gICAgICBpZiAobW9kZVkpIHtcbiAgICAgICAgdmFyIHkxID0geShkKTtcbiAgICAgICAgdmFyIHkyID0geTEgKyBoZWlnaHQoZCk7XG4gICAgICAgIC8vICAgICAgICAgICAgYmVnaW5pbmcgc2VsICAgICAgICAgICAgICAgZW5kIHNlbFxuICAgICAgICB2YXIgbWF0Y2hZMSA9IGV4dGVudFswXVsxXSA8PSB5MSAmJiB5MiA8IGV4dGVudFsxXVsxXTtcbiAgICAgICAgdmFyIG1hdGNoWTIgPSBleHRlbnRbMF1bMV0gPD0geTIgJiYgeTEgPD0gZXh0ZW50WzFdWzFdO1xuXG4gICAgICAgIG1hdGNoWSA9IChtYXRjaFkxIHx8IG1hdGNoWTIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbWF0Y2hZID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG1hdGNoWCAmJiBtYXRjaFk7XG4gICAgfSk7XG4gICAgKi9cbiAgfVxuXG4gIGhhbmRsZURyYWcoaXRlbSwgZSkge1xuICAgIGlmIChpdGVtID09PSBudWxsKSB7IHJldHVybjsgfVxuXG4gICAgdmFyIGNsYXNzTGlzdCA9IGUudGFyZ2V0LmNsYXNzTGlzdDtcbiAgICB2YXIgbW9kZSA9ICdtb3ZlJztcbiAgICAvLyBpZiB0aGUgdGFyZ2V0IGlzIGFuIGhhbmRsZXJcbiAgICBpZiAoY2xhc3NMaXN0LmNvbnRhaW5zKCdsZWZ0JykpIHsgbW9kZSA9ICdyZXNpemVMZWZ0JzsgfVxuICAgIGlmIChjbGFzc0xpc3QuY29udGFpbnMoJ3JpZ2h0JykpIHsgbW9kZSA9ICdyZXNpemVSaWdodCc7IH1cblxuICAgIHRoaXNbbW9kZV0oaXRlbSwgZS5vcmlnaW5hbEV2ZW50LmR4LCBlLm9yaWdpbmFsRXZlbnQuZHkpO1xuICB9XG5cbiAgbW92ZShpdGVtLCBkeCwgZHkpIHtcbiAgICBpdGVtID0gdGhpcy5kMy5zZWxlY3QoaXRlbSk7XG4gICAgdmFyIGRhdHVtID0gaXRlbS5kYXR1bSgpO1xuICAgIC8vIGRlZmluZSBjb25zdHJhaW5zXG4gICAgdmFyIGNvbnN0cmFpbnMgPSB0aGlzLnBhcmFtKCdlZGl0cycpO1xuICAgIHZhciBjYW5YID0gISF+Y29uc3RyYWlucy5pbmRleE9mKCd4Jyk7XG4gICAgdmFyIGNhblkgPSAhIX5jb25zdHJhaW5zLmluZGV4T2YoJ3knKTtcbiAgICAvLyBlYXJseSByZXR1cm4gaWYgY2Fubm90IGVkaXQgeCBhbmQgeVxuICAgIGlmICghY2FuWCAmJiAhY2FuWSkgeyByZXR1cm47IH1cbiAgICAvLyBlbHNlIGxvY2sgdGhlIGNvcnJlc3BvbmRpbmcgYXhpc1xuICAgIGlmICghY2FuWCkgeyBkeCA9IDA7IH1cbiAgICBpZiAoIWNhblkpIHsgZHkgPSAwOyB9XG5cbiAgICB2YXIgYWNjZXNzb3JzID0gdGhpcy5nZXRBY2Nlc3NvcnMoKTtcblxuICAgIHZhciB4U2NhbGUgPSBhY2Nlc3NvcnMueFNjYWxlO1xuICAgIHZhciB5U2NhbGUgPSBhY2Nlc3NvcnMueVNjYWxlO1xuICAgIHZhciB4UmFuZ2UgPSB4U2NhbGUucmFuZ2UoKTtcbiAgICB2YXIgeVJhbmdlID0geVNjYWxlLnJhbmdlKCk7XG5cbiAgICB2YXIgeCA9IGFjY2Vzc29ycy54KGRhdHVtKTtcbiAgICB2YXIgdyA9IGFjY2Vzc29ycy53KGRhdHVtKTtcbiAgICB2YXIgaCA9IGFjY2Vzc29ycy5oKGRhdHVtKTtcbiAgICB2YXIgeSA9IHlTY2FsZSh0aGlzLnkoKShkYXR1bSkpO1xuXG4gICAgLy8gaGFuZGxlIHggcG9zaXRpb24gLSBsb2NrIHRvIGJvdW5kYXJpZXNcbiAgICB2YXIgdGFyZ2V0WCA9IHggKyBkeDtcbiAgICBpZiAodGFyZ2V0WCA+PSB4UmFuZ2VbMF0gJiYgKHRhcmdldFggKyB3KSA8PSB4UmFuZ2VbMV0pIHtcbiAgICAgIHggPSB0YXJnZXRYO1xuICAgIH0gZWxzZSBpZiAodGFyZ2V0WCA8IHhSYW5nZVswXSkge1xuICAgICAgeCA9IHhSYW5nZVswXTtcbiAgICB9IGVsc2UgaWYgKCh0YXJnZXRYICsgdykgPiB4UmFuZ2VbMV0pIHtcbiAgICAgIHggPSB4UmFuZ2VbMV0gLSB3O1xuICAgIH1cblxuICAgIC8vIGhhbmRsZSB5IHBvc2l0aW9uIC0gbG9jayB0byBib3VuZGFyaWVzXG4gICAgdmFyIHRhcmdldFkgPSB5IC0gZHk7XG4gICAgdmFyIHlEaXNwbGF5ZWQgPSB5UmFuZ2VbMV0gLSBoIC0gdGFyZ2V0WTtcblxuICAgIGlmICh5RGlzcGxheWVkID49IHlSYW5nZVswXSAmJiAoeURpc3BsYXllZCArIGgpIDw9IHlSYW5nZVsxXSkge1xuICAgICAgeSA9IHRhcmdldFk7XG4gICAgfSBlbHNlIGlmICh5RGlzcGxheWVkIDwgeVJhbmdlWzBdKSB7XG4gICAgICB5ID0geVJhbmdlWzFdIC0gaDtcbiAgICB9IGVsc2UgaWYgKCh5RGlzcGxheWVkICsgaCkgPiB5UmFuZ2VbMV0pIHtcbiAgICAgIHkgPSB5UmFuZ2VbMF07XG4gICAgfVxuXG4gICAgdmFyIHhWYWx1ZSA9IHhTY2FsZS5pbnZlcnQoeCk7XG4gICAgdmFyIHlWYWx1ZSA9IHlTY2FsZS5pbnZlcnQoeSk7XG5cbiAgICB0aGlzLnN0YXJ0KCkoZGF0dW0sIHhWYWx1ZSk7XG4gICAgdGhpcy55KCkoZGF0dW0sIHlWYWx1ZSk7XG5cbiAgICB0aGlzLmRyYXcoaXRlbSk7XG4gIH1cblxuICByZXNpemVMZWZ0KGl0ZW0sIGR4LCBkeSkge1xuICAgIGl0ZW0gPSB0aGlzLmQzLnNlbGVjdChpdGVtKTtcbiAgICB2YXIgZGF0dW0gPSBpdGVtLmRhdHVtKCk7XG5cbiAgICB2YXIgY29uc3RyYWlucyA9IHRoaXMucGFyYW0oJ2VkaXRzJyk7XG4gICAgdmFyIGNhblcgPSAhIX5jb25zdHJhaW5zLmluZGV4T2YoJ3dpZHRoJyk7XG4gICAgLy8gZWFybHkgcmV0dXJuIGlmIGNhbm5vdCBlZGl0XG4gICAgaWYgKCFjYW5XKSB7IHJldHVybjsgfVxuXG4gICAgdmFyIGFjY2Vzc29ycyA9IHRoaXMuZ2V0QWNjZXNzb3JzKCk7XG4gICAgdmFyIHhSYW5nZSA9IGFjY2Vzc29ycy54U2NhbGUucmFuZ2UoKTtcblxuICAgIHZhciB4ID0gYWNjZXNzb3JzLngoZGF0dW0pO1xuICAgIHZhciB3ID0gYWNjZXNzb3JzLncoZGF0dW0pO1xuXG4gICAgdmFyIHRhcmdldFggPSB4ICsgZHg7XG4gICAgdmFyIHRhcmdldFcgPSB3IC0gZHg7XG5cbiAgICBpZiAodGFyZ2V0WCA+PSB4UmFuZ2VbMF0gJiYgdGFyZ2V0VyA+PSB0aGlzLl9fbWluV2lkdGgpIHtcbiAgICAgIHggPSB0YXJnZXRYO1xuICAgICAgdyA9IHRhcmdldFc7XG4gICAgfVxuXG4gICAgdmFyIHhWYWx1ZSA9IGFjY2Vzc29ycy54U2NhbGUuaW52ZXJ0KHgpO1xuICAgIHZhciBtaW5Eb21haW4gPSBhY2Nlc3NvcnMueFNjYWxlLmRvbWFpbigpWzBdO1xuICAgIHZhciB3VmFsdWUgPSBhY2Nlc3NvcnMueFNjYWxlLmludmVydCh3KSAtIG1pbkRvbWFpbjtcblxuICAgIHRoaXMuc3RhcnQoKShkYXR1bSwgeFZhbHVlKTtcbiAgICB0aGlzLmR1cmF0aW9uKCkoZGF0dW0sIHdWYWx1ZSk7XG5cbiAgICB0aGlzLmRyYXcoaXRlbSk7XG4gIH1cblxuICByZXNpemVSaWdodChpdGVtLCBkeCwgZHkpIHtcbiAgICBpdGVtID0gdGhpcy5kMy5zZWxlY3QoaXRlbSk7XG4gICAgdmFyIGRhdHVtID0gaXRlbS5kYXR1bSgpO1xuXG4gICAgdmFyIGNvbnN0cmFpbnMgPSB0aGlzLnBhcmFtKCdlZGl0cycpO1xuICAgIHZhciBjYW5XID0gISF+Y29uc3RyYWlucy5pbmRleE9mKCd3aWR0aCcpO1xuICAgIC8vIGVhcmx5IHJldHVybiBpZiBjYW5ub3QgZWRpdFxuICAgIGlmICghY2FuVykgeyByZXR1cm47IH1cblxuICAgIHZhciBhY2Nlc3NvcnMgPSB0aGlzLmdldEFjY2Vzc29ycygpO1xuICAgIHZhciB4UmFuZ2UgPSBhY2Nlc3NvcnMueFNjYWxlLnJhbmdlKCk7XG5cbiAgICB2YXIgeCA9IGFjY2Vzc29ycy54KGRhdHVtKTtcbiAgICB2YXIgdyA9IGFjY2Vzc29ycy53KGRhdHVtKTtcblxuICAgIHZhciB0YXJnZXRXID0gdyArIGR4O1xuXG4gICAgaWYgKHRhcmdldFcgPj0gdGhpcy5fX21pbldpZHRoICYmICh4ICsgdGFyZ2V0VykgPD0geFJhbmdlWzFdKSB7XG4gICAgICB3ID0gdGFyZ2V0VztcbiAgICB9XG5cbiAgICB2YXIgbWluRG9tYWluID0gYWNjZXNzb3JzLnhTY2FsZS5kb21haW4oKVswXTtcbiAgICB2YXIgd1ZhbHVlID0gYWNjZXNzb3JzLnhTY2FsZS5pbnZlcnQodykgLSBtaW5Eb21haW47XG4gICAgdGhpcy5kdXJhdGlvbigpKGRhdHVtLCB3VmFsdWUpO1xuXG4gICAgdGhpcy5kcmF3KGl0ZW0pO1xuICB9XG5cbn1cblxuLy8gYWRkIGFuZCBpbml0aWFsaXplIG91ciBhY2Nlc3NvcnNcbmFjY2Vzc29ycy5nZXRGdW5jdGlvbihTZWdtZW50LnByb3RvdHlwZSwgW1xuICAneScsICd3aWR0aCcsICdjb2xvcicsICdoZWlnaHQnLCAnZHVyYXRpb24nLCAnc3RhcnQnLCAnc29ydEluZGV4JywgJ29wYWNpdHknXG5dKTtcblxuZnVuY3Rpb24gZmFjdG9yeSgpIHsgcmV0dXJuIG5ldyBTZWdtZW50KCk7IH1cbmZhY3RvcnkuU2VnbWVudCA9IFNlZ21lbnQ7XG5cbm1vZHVsZS5leHBvcnRzID0gZmFjdG9yeTtcbiJdfQ==
"use strict";

var EventEmitter = require("events").EventEmitter;

function observe(proto) {
  var obj = new EventEmitter();

  function add(obj, prop) {
    var val = arguments[2] === undefined ? null : arguments[2];
    var _prop = "_" + prop;
    if (!obj.hasOwnProperty(_prop)) obj[_prop] = val;

    Object.defineProperty(obj, prop, {
      get: function () {
        return this[_prop];
      },
      set: function (v) {
        if (v !== this["_" + prop]) {
          this.emit("change", { property: prop, oldValue: this["_" + prop], value: v });
          this["_" + prop] = v;
        }
      },
      enumerable: true,
      configurable: true
    });
  }

  for (var prop in proto) {
    add(obj, prop, proto[prop]);
  }

  return obj;
}

module.exports = observe;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vbGliL29ic2VydmUuZXM2LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSSxZQUFZLEdBQUcsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLFlBQVksQ0FBQzs7QUFFbEQsU0FBUyxPQUFPLENBQUMsS0FBSyxFQUFDO0FBQ3JCLE1BQUksR0FBRyxHQUFHLElBQUksWUFBWSxFQUFFLENBQUM7O0FBRTdCLFdBQVMsR0FBRyxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQWM7UUFBWixHQUFHLGdDQUFHLElBQUk7QUFDaEMsUUFBSSxLQUFLLEdBQUcsR0FBRyxHQUFHLElBQUksQ0FBQztBQUN2QixRQUFJLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsRUFBRSxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsR0FBRyxDQUFDOztBQUVqRCxVQUFNLENBQUMsY0FBYyxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUU7QUFDL0IsU0FBRyxFQUFFLFlBQVc7QUFBRSxlQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztPQUFFO0FBQ3ZDLFNBQUcsRUFBRSxVQUFTLENBQUMsRUFBRTtBQUNmLFlBQUcsQ0FBQyxLQUFLLElBQUksT0FBSyxJQUFJLENBQUcsRUFBQztBQUN4QixjQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxFQUFDLFFBQVEsRUFBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLElBQUksT0FBSyxJQUFJLENBQUcsRUFBRSxPQUFRLENBQUMsRUFBQyxDQUFDLENBQUM7QUFDNUUsY0FBSSxPQUFLLElBQUksQ0FBRyxHQUFHLENBQUMsQ0FBQztTQUN0QjtPQUNGO0FBQ0QsZ0JBQVUsRUFBRSxJQUFJO0FBQ2hCLGtCQUFZLEVBQUUsSUFBSTtLQUNuQixDQUFDLENBQUM7R0FFSjs7QUFFRCxPQUFJLElBQUksSUFBSSxJQUFJLEtBQUssRUFBRTtBQUNyQixPQUFHLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztHQUM3Qjs7QUFFRCxTQUFPLEdBQUcsQ0FBQztDQUNaOztBQUVELE1BQU0sQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDIiwiZmlsZSI6Ii4vbGliL29ic2VydmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgRXZlbnRFbWl0dGVyID0gcmVxdWlyZShcImV2ZW50c1wiKS5FdmVudEVtaXR0ZXI7XG5cbmZ1bmN0aW9uIG9ic2VydmUocHJvdG8pe1xuICBsZXQgb2JqID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gIGZ1bmN0aW9uIGFkZChvYmosIHByb3AsIHZhbCA9IG51bGwpIHtcbiAgICB2YXIgX3Byb3AgPSAnXycgKyBwcm9wO1xuICAgIGlmICghb2JqLmhhc093blByb3BlcnR5KF9wcm9wKSkgb2JqW19wcm9wXSA9IHZhbDtcblxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIHByb3AsIHtcbiAgICAgIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzW19wcm9wXTsgfSxcbiAgICAgIHNldDogZnVuY3Rpb24odikge1xuICAgICAgICBpZih2ICE9PSB0aGlzW2BfJHtwcm9wfWBdKXtcbiAgICAgICAgICB0aGlzLmVtaXQoJ2NoYW5nZScsIHtwcm9wZXJ0eTpwcm9wLCBvbGRWYWx1ZTogdGhpc1tgXyR7cHJvcH1gXSwgJ3ZhbHVlJzp2fSk7XG4gICAgICAgICAgdGhpc1tgXyR7cHJvcH1gXSA9IHY7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG5cbiAgfVxuXG4gIGZvcih2YXIgcHJvcCBpbiBwcm90bykge1xuICAgIGFkZChvYmosIHByb3AsIHByb3RvW3Byb3BdKTtcbiAgfVxuXG4gIHJldHVybiBvYmo7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gb2JzZXJ2ZTsiXX0=
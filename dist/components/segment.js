"use strict";

var _babelHelpers = require("babel-runtime/helpers")["default"];

var _core = require("babel-runtime/core-js")["default"];

var _require = require("../helpers/utils");

var uniqueId = _require.uniqueId;
var accessors = _require.accessors;

var _require2 = require("../core/layer");

var Layer = _require2.Layer;

var Segment = (function (Layer) {
  function Segment() {
    _babelHelpers.classCallCheck(this, Segment);

    _babelHelpers.get(_core.Object.getPrototypeOf(Segment.prototype), "constructor", this).call(this);
    // set layer defaults
    this.params({
      type: "segment",
      opacity: 1,
      edits: ["x", "y", "width", "height"],
      handlerWidth: 2,
      handlerOpacity: 0
    });

    this.__minWidth = 1;

    // initialize data accessors
    this.y(function (d) {
      var v = arguments[1] === undefined ? null : arguments[1];

      if (v === null) return +d.y || 0;
      d.y = +v;
    });

    this.height(function (d) {
      var v = arguments[1] === undefined ? null : arguments[1];

      if (v === null) return +d.height || 1;
      d.height = +v;
    });

    this.duration(function (d) {
      var v = arguments[1] === undefined ? null : arguments[1];

      if (v === null) return +d.duration || 1;
      d.duration = +v;
    });

    this.start(function (d) {
      var v = arguments[1] === undefined ? null : arguments[1];

      if (v === null) return +d.start || 0;
      d.start = +v;
    });

    this.color(function (d) {
      var v = arguments[1] === undefined ? null : arguments[1];

      if (v === null) return d.color ? d.color + "" : "#000000";
      d.color = v + "";
    });

    this.opacity(function (d) {
      var v = arguments[1] === undefined ? null : arguments[1];

      if (v === null) return d.opacity;
      d.opacity = v + "";
    });
  }

  _babelHelpers.inherits(Segment, Layer);

  _babelHelpers.prototypeProperties(Segment, null, {
    getAccessors: {

      // @NOTE add some caching system ?

      value: function getAccessors() {
        var _this = this;

        // reverse yScale to have logical sizes
        // only y is problematic this way
        var xScale = this.base.xScale;
        var yScale = this.yScale.copy();
        yScale.range(yScale.range().slice(0).reverse());
        var height = yScale.range()[1];
        var minDomain = xScale.domain()[0];

        var _x = this.start();
        var _y = this.y();
        var _w = this.duration();
        var _h = this.height();

        var _color = this.color();
        var _opacity = this.opacity();

        // define accesors
        var x = function (d) {
          return xScale(_x(d));
        };
        var w = function (d) {
          var width = xScale(minDomain + _w(d));
          return width < 0 ? 0 : width;
        };
        var h = function (d) {
          return yScale(_h(d));
        };
        var y = function (d) {
          return height - h(d) - yScale(_y(d));
        };

        var color = function (d) {
          return _color(d);
        };
        var opacity = function (d) {
          return _opacity(d) || _this.param("opacity");
        };

        var _handlerWidth = parseInt(this.param("handlerWidth"), 10);
        var _halfHandler = _handlerWidth * 0.5;

        // handler position
        var rhx = function (d) {
          var width = w(d);

          return width < _handlerWidth * 2 ? _handlerWidth + _this.__minWidth : width - _halfHandler;
        };

        return { w: w, h: h, x: x, y: y, color: color, opacity: opacity, xScale: xScale, yScale: yScale, rhx: rhx };
      },
      writable: true,
      configurable: true
    },
    update: {
      value: function update(data) {
        _babelHelpers.get(_core.Object.getPrototypeOf(Segment.prototype), "update", this).call(this, data);

        this.items = this.g.selectAll("." + this.param("unitClass")).data(this.data(), this.dataKey());

        var sel = this.items.enter().append("g").classed("item", true).classed(this.param("unitClass"), true);

        sel.append("rect");

        if (this.param("interactions").editable) {
          sel.append("line").attr("class", "handle left").attr("stroke-width", this.param("handlerWidth")).attr("stroke-opacity", this.param("handlerOpacity"));

          sel.append("line").attr("class", "handle right").attr("stroke-width", this.param("handlerWidth")).attr("stroke-opacity", this.param("handlerOpacity"));
        }

        this.items.exit().remove();
      },
      writable: true,
      configurable: true
    },
    draw: {
      value: function draw() {
        var el = arguments[0] === undefined ? null : arguments[0];

        el = el || this.items;

        var accessors = this.getAccessors();

        el.attr("transform", function (d) {
          return "translate(" + accessors.x(d) + ", " + accessors.y(d) + ")";
        });

        el.selectAll("rect").attr("x", 0).attr("y", 0).attr("width", accessors.w).attr("height", accessors.h).attr("fill", accessors.color).attr("fill-opacity", accessors.opacity);

        if (!!this.each()) {
          el.each(this.each());
        }

        if (this.param("interactions").editable) {

          var _handlerWidth = parseInt(this.param("handlerWidth"), 10);
          var _halfHandler = _handlerWidth * 0.5;

          el.selectAll(".handle.left").attr("x1", _halfHandler).attr("x2", _halfHandler).attr("y1", 0).attr("y2", accessors.h).style("stroke", accessors.color);

          el.selectAll(".handle.right").attr("x1", 0).attr("x2", 0).attr("y1", 0).attr("y2", accessors.h).attr("transform", function (d) {
            return "translate(" + accessors.rhx(d) + ", 0)";
          }).style("stroke", accessors.color);
        }
      },
      writable: true,
      configurable: true
    },
    xZoom: {
      value: function xZoom(val) {
        this.draw();
      },
      writable: true,
      configurable: true
    },
    handleBrush: {

      // logic performed to select an item from the brush

      value: function handleBrush(extent, e) {},
      writable: true,
      configurable: true
    },
    handleDrag: {
      value: function handleDrag(item, e) {
        if (item === null) {
          return;
        }

        var classList = e.target.classList;
        var mode = "move";
        // if the target is an handler
        if (classList.contains("left")) {
          mode = "resizeLeft";
        }
        if (classList.contains("right")) {
          mode = "resizeRight";
        }

        this[mode](item, e.originalEvent.dx, e.originalEvent.dy);
      },
      writable: true,
      configurable: true
    },
    move: {
      value: function move(item, dx, dy) {
        item = this.d3.select(item);
        var datum = item.datum();
        // define constrains
        var constrains = this.param("edits");
        var canX = !! ~constrains.indexOf("x");
        var canY = !! ~constrains.indexOf("y");
        // early return if cannot edit x and y
        if (!canX && !canY) {
          return;
        }
        // else lock the corresponding axis
        if (!canX) {
          dx = 0;
        }
        if (!canY) {
          dy = 0;
        }

        var accessors = this.getAccessors();

        var xScale = accessors.xScale;
        var yScale = accessors.yScale;
        var xRange = xScale.range();
        var yRange = yScale.range();

        var x = accessors.x(datum);
        var w = accessors.w(datum);
        var h = accessors.h(datum);
        var y = yScale(this.y()(datum));

        // handle x position - lock to boundaries
        var targetX = x + dx;
        if (targetX >= xRange[0] && targetX + w <= xRange[1]) {
          x = targetX;
        } else if (targetX < xRange[0]) {
          x = xRange[0];
        } else if (targetX + w > xRange[1]) {
          x = xRange[1] - w;
        }

        // handle y position - lock to boundaries
        var targetY = y - dy;
        var yDisplayed = yRange[1] - h - targetY;

        if (yDisplayed >= yRange[0] && yDisplayed + h <= yRange[1]) {
          y = targetY;
        } else if (yDisplayed < yRange[0]) {
          y = yRange[1] - h;
        } else if (yDisplayed + h > yRange[1]) {
          y = yRange[0];
        }

        var xValue = xScale.invert(x);
        var yValue = yScale.invert(y);

        this.start()(datum, xValue);
        this.y()(datum, yValue);

        this.draw(item);
      },
      writable: true,
      configurable: true
    },
    resizeLeft: {
      value: function resizeLeft(item, dx, dy) {
        item = this.d3.select(item);
        var datum = item.datum();

        var constrains = this.param("edits");
        var canW = !! ~constrains.indexOf("width");
        // early return if cannot edit
        if (!canW) {
          return;
        }

        var accessors = this.getAccessors();
        var xRange = accessors.xScale.range();

        var x = accessors.x(datum);
        var w = accessors.w(datum);

        var targetX = x + dx;
        var targetW = w - dx;

        if (targetX >= xRange[0] && targetW >= this.__minWidth) {
          x = targetX;
          w = targetW;
        }

        var xValue = accessors.xScale.invert(x);
        var minDomain = accessors.xScale.domain()[0];
        var wValue = accessors.xScale.invert(w) - minDomain;

        this.start()(datum, xValue);
        this.duration()(datum, wValue);

        this.draw(item);
      },
      writable: true,
      configurable: true
    },
    resizeRight: {
      value: function resizeRight(item, dx, dy) {
        item = this.d3.select(item);
        var datum = item.datum();

        var constrains = this.param("edits");
        var canW = !! ~constrains.indexOf("width");
        // early return if cannot edit
        if (!canW) {
          return;
        }

        var accessors = this.getAccessors();
        var xRange = accessors.xScale.range();

        var x = accessors.x(datum);
        var w = accessors.w(datum);

        var targetW = w + dx;

        if (targetW >= this.__minWidth && x + targetW <= xRange[1]) {
          w = targetW;
        }

        var minDomain = accessors.xScale.domain()[0];
        var wValue = accessors.xScale.invert(w) - minDomain;
        this.duration()(datum, wValue);

        this.draw(item);
      },
      writable: true,
      configurable: true
    }
  });

  return Segment;
})(Layer);

// add and initialize our accessors
accessors.getFunction(Segment.prototype, ["y", "width", "color", "height", "duration", "start", "sortIndex", "opacity"]);

function factory() {
  return new Segment();
}
factory.Segment = Segment;

module.exports = factory;

// brushItem(extent, mode) {
/*
mode = mode || 'xy'; // default tries to match both
 var modeX = mode.indexOf('x') >= 0;
var modeY = mode.indexOf('y') >= 0;
var matchX = false, matchY = false;
 // data mappers
var start = this.start();
var duration = this.duration();
var y = this.y();
var height = this.height();
 this.g.selectAll('.selectable').classed('selected', (d, i) => {
  // var offsetTop = (that.top() || 0) + (that.base.margin().top || 0);
  // var offsetLeft = (that.left || 0) + (that.base.margin().left || 0);
   // X match
  if (modeX) {
    var x1 = start(d);
    var x2 = x1 + duration(d);
    //            begining sel               end sel
    var matchX1 = extent[0][0] <= x1 && x2 < extent[1][0];
    var matchX2 = extent[0][0] <= x2 && x1 < extent[1][0];
     matchX = (matchX1 || matchX2);
  } else {
    matchX = true;
  }
   // Y match
  if (modeY) {
    var y1 = y(d);
    var y2 = y1 + height(d);
    //            begining sel               end sel
    var matchY1 = extent[0][1] <= y1 && y2 < extent[1][1];
    var matchY2 = extent[0][1] <= y2 && y1 <= extent[1][1];
     matchY = (matchY1 || matchY2);
  } else {
    matchY = true;
  }
   return matchX && matchY;
});
*/
//# sourceMappingURL=data:application/json;base64,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QUksQ0FBQyxDQUFDO09BQ2pCOzs7Ozs7U0F4VkcsT0FBTztHQUFTLEtBQUs7OztBQTZWM0IsU0FBUyxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLENBQ3ZDLEdBQUcsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBRSxTQUFTLENBQzdFLENBQUMsQ0FBQzs7QUFFSCxTQUFTLE9BQU8sR0FBRztBQUFFLFNBQU8sSUFBSSxPQUFPLEVBQUUsQ0FBQztDQUFFO0FBQzVDLE9BQU8sQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDOztBQUUxQixNQUFNLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyIsImZpbGUiOiJlczYvaGVscGVycy96b29tZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbnZhciB7IHVuaXF1ZUlkLCBhY2Nlc3NvcnMgfSA9IHJlcXVpcmUoJy4uL2hlbHBlcnMvdXRpbHMnKTtcbnZhciB7IExheWVyIH0gPSByZXF1aXJlKCcuLi9jb3JlL2xheWVyJyk7XG5cbmNsYXNzIFNlZ21lbnQgZXh0ZW5kcyBMYXllciB7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICAvLyBzZXQgbGF5ZXIgZGVmYXVsdHNcbiAgICB0aGlzLnBhcmFtcyh7XG4gICAgICB0eXBlOiAnc2VnbWVudCcsXG4gICAgICBvcGFjaXR5OiAxLFxuICAgICAgZWRpdHM6IFsneCcsICd5JywgJ3dpZHRoJywgJ2hlaWdodCddLFxuICAgICAgaGFuZGxlcldpZHRoOiAyLFxuICAgICAgaGFuZGxlck9wYWNpdHk6IDBcbiAgICB9KTtcblxuICAgIHRoaXMuX19taW5XaWR0aCA9IDE7XG5cbiAgICAvLyBpbml0aWFsaXplIGRhdGEgYWNjZXNzb3JzXG4gICAgdGhpcy55KGZ1bmN0aW9uKGQsIHYgPSBudWxsKSB7XG4gICAgICBpZiAodiA9PT0gbnVsbCkgcmV0dXJuICtkLnkgfHzCoDA7XG4gICAgICBkLnkgPSAoK3YpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5oZWlnaHQoZnVuY3Rpb24oZCwgdiA9IG51bGwpIHtcbiAgICAgIGlmICh2ID09PSBudWxsKSByZXR1cm4gK2QuaGVpZ2h0IHx8wqAxO1xuICAgICAgZC5oZWlnaHQgPSAoK3YpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5kdXJhdGlvbihmdW5jdGlvbihkLCB2ID0gbnVsbCkge1xuICAgICAgaWYgKHYgPT09IG51bGwpIHJldHVybiArZC5kdXJhdGlvbiB8fMKgMTtcbiAgICAgIGQuZHVyYXRpb24gPSAoK3YpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5zdGFydChmdW5jdGlvbihkLCB2ID0gbnVsbCkge1xuICAgICAgaWYgKHYgPT09IG51bGwpIHJldHVybiArZC5zdGFydCB8fCAwO1xuICAgICAgZC5zdGFydCA9ICgrdik7XG4gICAgfSk7XG5cbiAgICB0aGlzLmNvbG9yKGZ1bmN0aW9uKGQsIHYgPSBudWxsKSB7XG4gICAgICBpZiAodiA9PT0gbnVsbCkgcmV0dXJuIGQuY29sb3IgPyBkLmNvbG9yICsgJycgOiAnIzAwMDAwMCc7XG4gICAgICBkLmNvbG9yID0gdiArICcnO1xuICAgIH0pO1xuXG4gICAgdGhpcy5vcGFjaXR5KGZ1bmN0aW9uKGQsIHYgPSBudWxsKSB7XG4gICAgICBpZiAodiA9PT0gbnVsbCkgcmV0dXJuIGQub3BhY2l0eTtcbiAgICAgIGQub3BhY2l0eSA9IHYgKyAnJztcbiAgICB9KTtcbiAgfVxuXG4gIC8vIEBOT1RFIGFkZCBzb21lIGNhY2hpbmcgc3lzdGVtID9cbiAgZ2V0QWNjZXNzb3JzKCkge1xuICAgIC8vIHJldmVyc2UgeVNjYWxlIHRvIGhhdmUgbG9naWNhbCBzaXplc1xuICAgIC8vIG9ubHkgeSBpcyBwcm9ibGVtYXRpYyB0aGlzIHdheVxuICAgIHZhciB4U2NhbGUgPSB0aGlzLmJhc2UueFNjYWxlO1xuICAgIHZhciB5U2NhbGUgPSB0aGlzLnlTY2FsZS5jb3B5KCk7XG4gICAgeVNjYWxlLnJhbmdlKHlTY2FsZS5yYW5nZSgpLnNsaWNlKDApLnJldmVyc2UoKSk7XG4gICAgdmFyIGhlaWdodCA9IHlTY2FsZS5yYW5nZSgpWzFdO1xuICAgIHZhciBtaW5Eb21haW4gPSB4U2NhbGUuZG9tYWluKClbMF07XG5cbiAgICB2YXIgX3ggPSB0aGlzLnN0YXJ0KCk7XG4gICAgdmFyIF95ID0gdGhpcy55KCk7XG4gICAgdmFyIF93ID0gdGhpcy5kdXJhdGlvbigpO1xuICAgIHZhciBfaCA9IHRoaXMuaGVpZ2h0KCk7XG5cbiAgICB2YXIgX2NvbG9yICAgID0gdGhpcy5jb2xvcigpO1xuICAgIHZhciBfb3BhY2l0eSAgPSB0aGlzLm9wYWNpdHkoKTtcblxuICAgIC8vIGRlZmluZSBhY2Nlc29yc1xuICAgIHZhciB4ID0gKGQpID0+IHsgcmV0dXJuIHhTY2FsZShfeChkKSk7IH07XG4gICAgdmFyIHcgPSAoZCkgPT4ge1xuICAgICAgdmFyIHdpZHRoID0geFNjYWxlKG1pbkRvbWFpbiArIF93KGQpKTtcbiAgICAgIHJldHVybiB3aWR0aCA8IDAgPyAwIDogd2lkdGg7XG4gICAgfTtcbiAgICB2YXIgaCA9IChkKSA9PiB7IHJldHVybiB5U2NhbGUoX2goZCkpOyB9O1xuICAgIHZhciB5ID0gKGQpID0+IHsgcmV0dXJuIGhlaWdodCAtIGgoZCkgLSB5U2NhbGUoX3koZCkpOyB9O1xuXG4gICAgdmFyIGNvbG9yID0gKGQpID0+IHsgcmV0dXJuIF9jb2xvcihkKTsgfTtcbiAgICB2YXIgb3BhY2l0eSA9IChkKSA9PiB7IHJldHVybiAoX29wYWNpdHkoZCkgfHzCoHRoaXMucGFyYW0oJ29wYWNpdHknKSk7IH07XG5cbiAgICB2YXIgX2hhbmRsZXJXaWR0aCA9IHBhcnNlSW50KHRoaXMucGFyYW0oJ2hhbmRsZXJXaWR0aCcpLCAxMCk7XG4gICAgdmFyIF9oYWxmSGFuZGxlciA9IF9oYW5kbGVyV2lkdGggKiAwLjU7XG5cbiAgICAvLyBoYW5kbGVyIHBvc2l0aW9uXG4gICAgdmFyIHJoeCA9IChkKSA9PiB7XG4gICAgICBsZXQgd2lkdGggPSB3KGQpO1xuXG4gICAgICByZXR1cm4gKHdpZHRoIDwgKF9oYW5kbGVyV2lkdGggKiAyKSkgP1xuICAgICAgICBfaGFuZGxlcldpZHRoICsgdGhpcy5fX21pbldpZHRoIDogd2lkdGggLSBfaGFsZkhhbmRsZXI7XG4gICAgfTtcblxuICAgIHJldHVybiB7IHcsIGgsIHgsIHksIGNvbG9yLCBvcGFjaXR5LCB4U2NhbGUsIHlTY2FsZSwgcmh4IH07XG4gIH1cblxuICB1cGRhdGUoZGF0YSkge1xuICAgIHN1cGVyLnVwZGF0ZShkYXRhKTtcblxuICAgIHRoaXMuaXRlbXMgPSB0aGlzLmcuc2VsZWN0QWxsKCcuJyArIHRoaXMucGFyYW0oJ3VuaXRDbGFzcycpKVxuICAgICAgLmRhdGEodGhpcy5kYXRhKCksIHRoaXMuZGF0YUtleSgpKTtcblxuICAgIHZhciBzZWwgPSB0aGlzLml0ZW1zLmVudGVyKClcbiAgICAgIC5hcHBlbmQoJ2cnKVxuICAgICAgLmNsYXNzZWQoJ2l0ZW0nLCB0cnVlKVxuICAgICAgLmNsYXNzZWQodGhpcy5wYXJhbSgndW5pdENsYXNzJyksIHRydWUpO1xuXG4gICAgc2VsLmFwcGVuZCgncmVjdCcpO1xuXG4gICAgaWYgKHRoaXMucGFyYW0oJ2ludGVyYWN0aW9ucycpLmVkaXRhYmxlKSB7XG4gICAgICBzZWwuYXBwZW5kKCdsaW5lJylcbiAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2hhbmRsZSBsZWZ0JylcbiAgICAgICAgLmF0dHIoJ3N0cm9rZS13aWR0aCcsIHRoaXMucGFyYW0oJ2hhbmRsZXJXaWR0aCcpKVxuICAgICAgICAuYXR0cignc3Ryb2tlLW9wYWNpdHknLCB0aGlzLnBhcmFtKCdoYW5kbGVyT3BhY2l0eScpKTtcblxuICAgICAgc2VsLmFwcGVuZCgnbGluZScpXG4gICAgICAgIC5hdHRyKCdjbGFzcycsICdoYW5kbGUgcmlnaHQnKVxuICAgICAgICAuYXR0cignc3Ryb2tlLXdpZHRoJywgdGhpcy5wYXJhbSgnaGFuZGxlcldpZHRoJykpXG4gICAgICAgIC5hdHRyKCdzdHJva2Utb3BhY2l0eScsIHRoaXMucGFyYW0oJ2hhbmRsZXJPcGFjaXR5JykpO1xuICAgIH1cblxuICAgIHRoaXMuaXRlbXMuZXhpdCgpLnJlbW92ZSgpO1xuICB9XG5cbiAgZHJhdyhlbCA9IG51bGwpIHtcbiAgICBlbCA9IGVsIHx8IHRoaXMuaXRlbXM7XG5cbiAgICB2YXIgYWNjZXNzb3JzID0gdGhpcy5nZXRBY2Nlc3NvcnMoKTtcblxuICAgIGVsLmF0dHIoJ3RyYW5zZm9ybScsIChkKSA9PiB7XG4gICAgICByZXR1cm4gJ3RyYW5zbGF0ZSgnICsgYWNjZXNzb3JzLngoZCkgKyAnLCAnICsgYWNjZXNzb3JzLnkoZCkgKyAnKSc7XG4gICAgfSk7XG5cbiAgICBlbC5zZWxlY3RBbGwoJ3JlY3QnKVxuICAgICAgLmF0dHIoJ3gnLCAwKVxuICAgICAgLmF0dHIoJ3knLCAwKVxuICAgICAgLmF0dHIoJ3dpZHRoJywgYWNjZXNzb3JzLncpXG4gICAgICAuYXR0cignaGVpZ2h0JywgYWNjZXNzb3JzLmgpXG4gICAgICAuYXR0cignZmlsbCcsIGFjY2Vzc29ycy5jb2xvcilcbiAgICAgIC5hdHRyKCdmaWxsLW9wYWNpdHknLCBhY2Nlc3NvcnMub3BhY2l0eSk7XG5cbiAgICBpZiAoISF0aGlzLmVhY2goKSkgeyBlbC5lYWNoKHRoaXMuZWFjaCgpKTsgfVxuXG4gICAgaWYgKHRoaXMucGFyYW0oJ2ludGVyYWN0aW9ucycpLmVkaXRhYmxlKSB7XG5cbiAgICAgIHZhciBfaGFuZGxlcldpZHRoID0gcGFyc2VJbnQodGhpcy5wYXJhbSgnaGFuZGxlcldpZHRoJyksIDEwKTtcbiAgICAgIHZhciBfaGFsZkhhbmRsZXIgPSBfaGFuZGxlcldpZHRoICogMC41O1xuXG4gICAgICBlbC5zZWxlY3RBbGwoJy5oYW5kbGUubGVmdCcpXG4gICAgICAgIC5hdHRyKCd4MScsIF9oYWxmSGFuZGxlcilcbiAgICAgICAgLmF0dHIoJ3gyJywgX2hhbGZIYW5kbGVyKVxuICAgICAgICAuYXR0cigneTEnLCAwKVxuICAgICAgICAuYXR0cigneTInLCBhY2Nlc3NvcnMuaClcbiAgICAgICAgLnN0eWxlKCdzdHJva2UnLCBhY2Nlc3NvcnMuY29sb3IpO1xuXG4gICAgICBlbC5zZWxlY3RBbGwoJy5oYW5kbGUucmlnaHQnKVxuICAgICAgICAuYXR0cigneDEnLCAwKVxuICAgICAgICAuYXR0cigneDInLCAwKVxuICAgICAgICAuYXR0cigneTEnLCAwKVxuICAgICAgICAuYXR0cigneTInLCBhY2Nlc3NvcnMuaClcbiAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsIChkKSA9PiB7XG4gICAgICAgICAgcmV0dXJuICd0cmFuc2xhdGUoJyArIGFjY2Vzc29ycy5yaHgoZCkgKyAnLCAwKSc7XG4gICAgICAgIH0pXG4gICAgICAgIC5zdHlsZSgnc3Ryb2tlJywgYWNjZXNzb3JzLmNvbG9yKTtcbiAgICB9XG4gIH1cblxuICB4Wm9vbSh2YWwpIHtcbiAgICB0aGlzLmRyYXcoKTtcbiAgfVxuXG4gIC8vIGxvZ2ljIHBlcmZvcm1lZCB0byBzZWxlY3QgYW4gaXRlbSBmcm9tIHRoZSBicnVzaFxuICBoYW5kbGVCcnVzaChleHRlbnQsIGUpIHtcbiAgLy8gYnJ1c2hJdGVtKGV4dGVudCwgbW9kZSkge1xuICAgIC8qXG4gICAgbW9kZSA9IG1vZGUgfHwgJ3h5JzsgLy8gZGVmYXVsdCB0cmllcyB0byBtYXRjaCBib3RoXG5cbiAgICB2YXIgbW9kZVggPSBtb2RlLmluZGV4T2YoJ3gnKSA+PSAwO1xuICAgIHZhciBtb2RlWSA9IG1vZGUuaW5kZXhPZigneScpID49IDA7XG4gICAgdmFyIG1hdGNoWCA9IGZhbHNlLCBtYXRjaFkgPSBmYWxzZTtcblxuICAgIC8vIGRhdGEgbWFwcGVyc1xuICAgIHZhciBzdGFydCA9IHRoaXMuc3RhcnQoKTtcbiAgICB2YXIgZHVyYXRpb24gPSB0aGlzLmR1cmF0aW9uKCk7XG4gICAgdmFyIHkgPSB0aGlzLnkoKTtcbiAgICB2YXIgaGVpZ2h0ID0gdGhpcy5oZWlnaHQoKTtcblxuICAgIHRoaXMuZy5zZWxlY3RBbGwoJy5zZWxlY3RhYmxlJykuY2xhc3NlZCgnc2VsZWN0ZWQnLCAoZCwgaSkgPT4ge1xuICAgICAgLy8gdmFyIG9mZnNldFRvcCA9ICh0aGF0LnRvcCgpIHx8IDApICsgKHRoYXQuYmFzZS5tYXJnaW4oKS50b3AgfHwgMCk7XG4gICAgICAvLyB2YXIgb2Zmc2V0TGVmdCA9ICh0aGF0LmxlZnQgfHwgMCkgKyAodGhhdC5iYXNlLm1hcmdpbigpLmxlZnQgfHwgMCk7XG5cbiAgICAgIC8vIFggbWF0Y2hcbiAgICAgIGlmIChtb2RlWCkge1xuICAgICAgICB2YXIgeDEgPSBzdGFydChkKTtcbiAgICAgICAgdmFyIHgyID0geDEgKyBkdXJhdGlvbihkKTtcbiAgICAgICAgLy8gICAgICAgICAgICBiZWdpbmluZyBzZWwgICAgICAgICAgICAgICBlbmQgc2VsXG4gICAgICAgIHZhciBtYXRjaFgxID0gZXh0ZW50WzBdWzBdIDw9IHgxICYmIHgyIDwgZXh0ZW50WzFdWzBdO1xuICAgICAgICB2YXIgbWF0Y2hYMiA9IGV4dGVudFswXVswXSA8PSB4MiAmJiB4MSA8IGV4dGVudFsxXVswXTtcblxuICAgICAgICBtYXRjaFggPSAobWF0Y2hYMSB8fCBtYXRjaFgyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1hdGNoWCA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIC8vIFkgbWF0Y2hcbiAgICAgIGlmIChtb2RlWSkge1xuICAgICAgICB2YXIgeTEgPSB5KGQpO1xuICAgICAgICB2YXIgeTIgPSB5MSArIGhlaWdodChkKTtcbiAgICAgICAgLy8gICAgICAgICAgICBiZWdpbmluZyBzZWwgICAgICAgICAgICAgICBlbmQgc2VsXG4gICAgICAgIHZhciBtYXRjaFkxID0gZXh0ZW50WzBdWzFdIDw9IHkxICYmIHkyIDwgZXh0ZW50WzFdWzFdO1xuICAgICAgICB2YXIgbWF0Y2hZMiA9IGV4dGVudFswXVsxXSA8PSB5MiAmJiB5MSA8PSBleHRlbnRbMV1bMV07XG5cbiAgICAgICAgbWF0Y2hZID0gKG1hdGNoWTEgfHwgbWF0Y2hZMik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtYXRjaFkgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbWF0Y2hYICYmIG1hdGNoWTtcbiAgICB9KTtcbiAgICAqL1xuICB9XG5cbiAgaGFuZGxlRHJhZyhpdGVtLCBlKSB7XG4gICAgaWYgKGl0ZW0gPT09IG51bGwpIHsgcmV0dXJuOyB9XG5cbiAgICB2YXIgY2xhc3NMaXN0ID0gZS50YXJnZXQuY2xhc3NMaXN0O1xuICAgIHZhciBtb2RlID0gJ21vdmUnO1xuICAgIC8vIGlmIHRoZSB0YXJnZXQgaXMgYW4gaGFuZGxlclxuICAgIGlmIChjbGFzc0xpc3QuY29udGFpbnMoJ2xlZnQnKSkgeyBtb2RlID0gJ3Jlc2l6ZUxlZnQnOyB9XG4gICAgaWYgKGNsYXNzTGlzdC5jb250YWlucygncmlnaHQnKSkgeyBtb2RlID0gJ3Jlc2l6ZVJpZ2h0JzsgfVxuXG4gICAgdGhpc1ttb2RlXShpdGVtLCBlLm9yaWdpbmFsRXZlbnQuZHgsIGUub3JpZ2luYWxFdmVudC5keSk7XG4gIH1cblxuICBtb3ZlKGl0ZW0sIGR4LCBkeSkge1xuICAgIGl0ZW0gPSB0aGlzLmQzLnNlbGVjdChpdGVtKTtcbiAgICB2YXIgZGF0dW0gPSBpdGVtLmRhdHVtKCk7XG4gICAgLy8gZGVmaW5lIGNvbnN0cmFpbnNcbiAgICB2YXIgY29uc3RyYWlucyA9IHRoaXMucGFyYW0oJ2VkaXRzJyk7XG4gICAgdmFyIGNhblggPSAhIX5jb25zdHJhaW5zLmluZGV4T2YoJ3gnKTtcbiAgICB2YXIgY2FuWSA9ICEhfmNvbnN0cmFpbnMuaW5kZXhPZigneScpO1xuICAgIC8vIGVhcmx5IHJldHVybiBpZiBjYW5ub3QgZWRpdCB4IGFuZCB5XG4gICAgaWYgKCFjYW5YICYmICFjYW5ZKSB7IHJldHVybjsgfVxuICAgIC8vIGVsc2UgbG9jayB0aGUgY29ycmVzcG9uZGluZyBheGlzXG4gICAgaWYgKCFjYW5YKSB7IGR4ID0gMDsgfVxuICAgIGlmICghY2FuWSkgeyBkeSA9IDA7IH1cblxuICAgIHZhciBhY2Nlc3NvcnMgPSB0aGlzLmdldEFjY2Vzc29ycygpO1xuXG4gICAgdmFyIHhTY2FsZSA9IGFjY2Vzc29ycy54U2NhbGU7XG4gICAgdmFyIHlTY2FsZSA9IGFjY2Vzc29ycy55U2NhbGU7XG4gICAgdmFyIHhSYW5nZSA9IHhTY2FsZS5yYW5nZSgpO1xuICAgIHZhciB5UmFuZ2UgPSB5U2NhbGUucmFuZ2UoKTtcblxuICAgIHZhciB4ID0gYWNjZXNzb3JzLngoZGF0dW0pO1xuICAgIHZhciB3ID0gYWNjZXNzb3JzLncoZGF0dW0pO1xuICAgIHZhciBoID0gYWNjZXNzb3JzLmgoZGF0dW0pO1xuICAgIHZhciB5ID0geVNjYWxlKHRoaXMueSgpKGRhdHVtKSk7XG5cbiAgICAvLyBoYW5kbGUgeCBwb3NpdGlvbiAtIGxvY2sgdG8gYm91bmRhcmllc1xuICAgIHZhciB0YXJnZXRYID0geCArIGR4O1xuICAgIGlmICh0YXJnZXRYID49IHhSYW5nZVswXSAmJiAodGFyZ2V0WCArIHcpIDw9IHhSYW5nZVsxXSkge1xuICAgICAgeCA9IHRhcmdldFg7XG4gICAgfSBlbHNlIGlmICh0YXJnZXRYIDwgeFJhbmdlWzBdKSB7XG4gICAgICB4ID0geFJhbmdlWzBdO1xuICAgIH0gZWxzZSBpZiAoKHRhcmdldFggKyB3KSA+IHhSYW5nZVsxXSkge1xuICAgICAgeCA9IHhSYW5nZVsxXSAtIHc7XG4gICAgfVxuXG4gICAgLy8gaGFuZGxlIHkgcG9zaXRpb24gLSBsb2NrIHRvIGJvdW5kYXJpZXNcbiAgICB2YXIgdGFyZ2V0WSA9IHkgLSBkeTtcbiAgICB2YXIgeURpc3BsYXllZCA9IHlSYW5nZVsxXSAtIGggLSB0YXJnZXRZO1xuXG4gICAgaWYgKHlEaXNwbGF5ZWQgPj0geVJhbmdlWzBdICYmICh5RGlzcGxheWVkICsgaCkgPD0geVJhbmdlWzFdKSB7XG4gICAgICB5ID0gdGFyZ2V0WTtcbiAgICB9IGVsc2UgaWYgKHlEaXNwbGF5ZWQgPCB5UmFuZ2VbMF0pIHtcbiAgICAgIHkgPSB5UmFuZ2VbMV0gLSBoO1xuICAgIH0gZWxzZSBpZiAoKHlEaXNwbGF5ZWQgKyBoKSA+IHlSYW5nZVsxXSkge1xuICAgICAgeSA9IHlSYW5nZVswXTtcbiAgICB9XG5cbiAgICB2YXIgeFZhbHVlID0geFNjYWxlLmludmVydCh4KTtcbiAgICB2YXIgeVZhbHVlID0geVNjYWxlLmludmVydCh5KTtcblxuICAgIHRoaXMuc3RhcnQoKShkYXR1bSwgeFZhbHVlKTtcbiAgICB0aGlzLnkoKShkYXR1bSwgeVZhbHVlKTtcblxuICAgIHRoaXMuZHJhdyhpdGVtKTtcbiAgfVxuXG4gIHJlc2l6ZUxlZnQoaXRlbSwgZHgsIGR5KSB7XG4gICAgaXRlbSA9IHRoaXMuZDMuc2VsZWN0KGl0ZW0pO1xuICAgIHZhciBkYXR1bSA9IGl0ZW0uZGF0dW0oKTtcblxuICAgIHZhciBjb25zdHJhaW5zID0gdGhpcy5wYXJhbSgnZWRpdHMnKTtcbiAgICB2YXIgY2FuVyA9ICEhfmNvbnN0cmFpbnMuaW5kZXhPZignd2lkdGgnKTtcbiAgICAvLyBlYXJseSByZXR1cm4gaWYgY2Fubm90IGVkaXRcbiAgICBpZiAoIWNhblcpIHsgcmV0dXJuOyB9XG5cbiAgICB2YXIgYWNjZXNzb3JzID0gdGhpcy5nZXRBY2Nlc3NvcnMoKTtcbiAgICB2YXIgeFJhbmdlID0gYWNjZXNzb3JzLnhTY2FsZS5yYW5nZSgpO1xuXG4gICAgdmFyIHggPSBhY2Nlc3NvcnMueChkYXR1bSk7XG4gICAgdmFyIHcgPSBhY2Nlc3NvcnMudyhkYXR1bSk7XG5cbiAgICB2YXIgdGFyZ2V0WCA9IHggKyBkeDtcbiAgICB2YXIgdGFyZ2V0VyA9IHcgLSBkeDtcblxuICAgIGlmICh0YXJnZXRYID49IHhSYW5nZVswXSAmJiB0YXJnZXRXID49IHRoaXMuX19taW5XaWR0aCkge1xuICAgICAgeCA9IHRhcmdldFg7XG4gICAgICB3ID0gdGFyZ2V0VztcbiAgICB9XG5cbiAgICB2YXIgeFZhbHVlID0gYWNjZXNzb3JzLnhTY2FsZS5pbnZlcnQoeCk7XG4gICAgdmFyIG1pbkRvbWFpbiA9IGFjY2Vzc29ycy54U2NhbGUuZG9tYWluKClbMF07XG4gICAgdmFyIHdWYWx1ZSA9IGFjY2Vzc29ycy54U2NhbGUuaW52ZXJ0KHcpIC0gbWluRG9tYWluO1xuXG4gICAgdGhpcy5zdGFydCgpKGRhdHVtLCB4VmFsdWUpO1xuICAgIHRoaXMuZHVyYXRpb24oKShkYXR1bSwgd1ZhbHVlKTtcblxuICAgIHRoaXMuZHJhdyhpdGVtKTtcbiAgfVxuXG4gIHJlc2l6ZVJpZ2h0KGl0ZW0sIGR4LCBkeSkge1xuICAgIGl0ZW0gPSB0aGlzLmQzLnNlbGVjdChpdGVtKTtcbiAgICB2YXIgZGF0dW0gPSBpdGVtLmRhdHVtKCk7XG5cbiAgICB2YXIgY29uc3RyYWlucyA9IHRoaXMucGFyYW0oJ2VkaXRzJyk7XG4gICAgdmFyIGNhblcgPSAhIX5jb25zdHJhaW5zLmluZGV4T2YoJ3dpZHRoJyk7XG4gICAgLy8gZWFybHkgcmV0dXJuIGlmIGNhbm5vdCBlZGl0XG4gICAgaWYgKCFjYW5XKSB7IHJldHVybjsgfVxuXG4gICAgdmFyIGFjY2Vzc29ycyA9IHRoaXMuZ2V0QWNjZXNzb3JzKCk7XG4gICAgdmFyIHhSYW5nZSA9IGFjY2Vzc29ycy54U2NhbGUucmFuZ2UoKTtcblxuICAgIHZhciB4ID0gYWNjZXNzb3JzLngoZGF0dW0pO1xuICAgIHZhciB3ID0gYWNjZXNzb3JzLncoZGF0dW0pO1xuXG4gICAgdmFyIHRhcmdldFcgPSB3ICsgZHg7XG5cbiAgICBpZiAodGFyZ2V0VyA+PSB0aGlzLl9fbWluV2lkdGggJiYgKHggKyB0YXJnZXRXKSA8PSB4UmFuZ2VbMV0pIHtcbiAgICAgIHcgPSB0YXJnZXRXO1xuICAgIH1cblxuICAgIHZhciBtaW5Eb21haW4gPSBhY2Nlc3NvcnMueFNjYWxlLmRvbWFpbigpWzBdO1xuICAgIHZhciB3VmFsdWUgPSBhY2Nlc3NvcnMueFNjYWxlLmludmVydCh3KSAtIG1pbkRvbWFpbjtcbiAgICB0aGlzLmR1cmF0aW9uKCkoZGF0dW0sIHdWYWx1ZSk7XG5cbiAgICB0aGlzLmRyYXcoaXRlbSk7XG4gIH1cblxufVxuXG4vLyBhZGQgYW5kIGluaXRpYWxpemUgb3VyIGFjY2Vzc29yc1xuYWNjZXNzb3JzLmdldEZ1bmN0aW9uKFNlZ21lbnQucHJvdG90eXBlLCBbXG4gICd5JywgJ3dpZHRoJywgJ2NvbG9yJywgJ2hlaWdodCcsICdkdXJhdGlvbicsICdzdGFydCcsICdzb3J0SW5kZXgnLCAnb3BhY2l0eSdcbl0pO1xuXG5mdW5jdGlvbiBmYWN0b3J5KCkgeyByZXR1cm4gbmV3IFNlZ21lbnQoKTsgfVxuZmFjdG9yeS5TZWdtZW50ID0gU2VnbWVudDtcblxubW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5O1xuIl19
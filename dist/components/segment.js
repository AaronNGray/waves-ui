"use strict";

var _babelHelpers = require("babel-runtime/helpers")["default"];

var _core = require("babel-runtime/core-js")["default"];

var _require = require("../helpers/utils");

var uniqueId = _require.uniqueId;
var accessors = _require.accessors;

var _require2 = require("../core/layer");

var Layer = _require2.Layer;

var Segment = (function (Layer) {
  function Segment() {
    _babelHelpers.classCallCheck(this, Segment);

    _babelHelpers.get(_core.Object.getPrototypeOf(Segment.prototype), "constructor", this).call(this);
    // set layer defaults
    this.params({
      type: "segment",
      opacity: 1,
      edits: ["x", "y", "width", "height"],
      handlerWidth: 2,
      handlerOpacity: 0
    });

    this.__minWidth = 1;

    // initialize data accessors
    this.y(function (d) {
      var v = arguments[1] === undefined ? null : arguments[1];

      if (v === null) return +d.y || 0;
      d.y = +v;
    });

    this.height(function (d) {
      var v = arguments[1] === undefined ? null : arguments[1];

      if (v === null) return +d.height || 1;
      d.height = +v;
    });

    this.duration(function (d) {
      var v = arguments[1] === undefined ? null : arguments[1];

      if (v === null) return +d.duration || 1;
      d.duration = +v;
    });

    this.start(function (d) {
      var v = arguments[1] === undefined ? null : arguments[1];

      if (v === null) return +d.start || 0;
      d.start = +v;
    });

    this.color(function (d) {
      var v = arguments[1] === undefined ? null : arguments[1];

      if (v === null) return d.color ? d.color + "" : "#000000";
      d.color = v + "";
    });

    this.opacity(function (d) {
      var v = arguments[1] === undefined ? null : arguments[1];

      if (v === null) return d.opacity;
      d.opacity = v + "";
    });
  }

  _babelHelpers.inherits(Segment, Layer);

  _babelHelpers.prototypeProperties(Segment, null, {
    getAccessors: {

      // @NOTE add some caching system ?

      value: function getAccessors() {
        var _this = this;

        // reverse yScale to have logical sizes
        // only y is problematic this way
        var xScale = this.base.xScale;
        var yScale = this.yScale.copy();
        yScale.range(yScale.range().slice(0).reverse());
        var height = yScale.range()[1];
        var minDomain = xScale.domain()[0];

        var _x = this.start();
        var _y = this.y();
        var _w = this.duration();
        var _h = this.height();

        var _color = this.color();
        var _opacity = this.opacity();

        // define accesors
        var x = function (d) {
          return xScale(_x(d));
        };
        var w = function (d) {
          var width = xScale(minDomain + _w(d));
          return width < 0 ? 0 : width;
        };
        var h = function (d) {
          return yScale(_h(d));
        };
        var y = function (d) {
          return height - h(d) - yScale(_y(d));
        };

        var color = function (d) {
          return _color(d);
        };
        var opacity = function (d) {
          return _opacity(d) || _this.param("opacity");
        };

        var _handlerWidth = parseInt(this.param("handlerWidth"), 10);
        var _halfHandler = _handlerWidth * 0.5;

        // handler position
        var rhx = function (d) {
          var width = w(d);

          return width < _handlerWidth * 2 ? _handlerWidth + _this.__minWidth : width - _halfHandler;
        };

        return { w: w, h: h, x: x, y: y, color: color, opacity: opacity, xScale: xScale, yScale: yScale, rhx: rhx };
      },
      writable: true,
      configurable: true
    },
    update: {
      value: function update(data) {
        _babelHelpers.get(_core.Object.getPrototypeOf(Segment.prototype), "update", this).call(this, data);

        this.items = this.g.selectAll("." + this.param("unitClass")).data(this.data(), this.dataKey());

        var sel = this.items.enter().append("g").classed("item", true).classed(this.param("unitClass"), true);

        sel.append("rect");

        if (this.param("interactions").editable) {
          sel.append("line").attr("class", "handle left").attr("stroke-width", this.param("handlerWidth")).attr("stroke-opacity", this.param("handlerOpacity"));

          sel.append("line").attr("class", "handle right").attr("stroke-width", this.param("handlerWidth")).attr("stroke-opacity", this.param("handlerOpacity"));
        }

        this.items.exit().remove();
      },
      writable: true,
      configurable: true
    },
    draw: {
      value: function draw() {
        var el = arguments[0] === undefined ? null : arguments[0];

        el = el || this.items;

        var accessors = this.getAccessors();

        el.attr("transform", function (d) {
          return "translate(" + accessors.x(d) + ", " + accessors.y(d) + ")";
        });

        el.selectAll("rect").attr("x", 0).attr("y", 0).attr("width", accessors.w).attr("height", accessors.h).attr("fill", accessors.color).attr("fill-opacity", accessors.opacity);

        if (!!this.each()) {
          el.each(this.each());
        }

        if (this.param("interactions").editable) {

          var _handlerWidth = parseInt(this.param("handlerWidth"), 10);
          var _halfHandler = _handlerWidth * 0.5;

          el.selectAll(".handle.left").attr("x1", _halfHandler).attr("x2", _halfHandler).attr("y1", 0).attr("y2", accessors.h).style("stroke", accessors.color);

          el.selectAll(".handle.right").attr("x1", 0).attr("x2", 0).attr("y1", 0).attr("y2", accessors.h).attr("transform", function (d) {
            return "translate(" + accessors.rhx(d) + ", 0)";
          }).style("stroke", accessors.color);
        }
      },
      writable: true,
      configurable: true
    },
    xZoom: {
      value: function xZoom(val) {
        this.draw();
      },
      writable: true,
      configurable: true
    },
    handleBrush: {

      // logic performed to select an item from the brush

      value: function handleBrush(extent, e) {},
      writable: true,
      configurable: true
    },
    handleDrag: {
      value: function handleDrag(item, e) {
        if (item === null) {
          return;
        }

        var classList = e.target.classList;
        var mode = "move";
        // if the target is an handler
        if (classList.contains("left")) {
          mode = "resizeLeft";
        }
        if (classList.contains("right")) {
          mode = "resizeRight";
        }

        this[mode](item, e.originalEvent.dx, e.originalEvent.dy);
      },
      writable: true,
      configurable: true
    },
    move: {
      value: function move(item, dx, dy) {
        item = this.d3.select(item);
        var datum = item.datum();
        // define constrains
        var constrains = this.param("edits");
        var canX = !! ~constrains.indexOf("x");
        var canY = !! ~constrains.indexOf("y");
        // early return if cannot edit x and y
        if (!canX && !canY) {
          return;
        }
        // else lock the corresponding axis
        if (!canX) {
          dx = 0;
        }
        if (!canY) {
          dy = 0;
        }

        var accessors = this.getAccessors();

        var xScale = accessors.xScale;
        var yScale = accessors.yScale;
        var xRange = xScale.range();
        var yRange = yScale.range();

        var x = accessors.x(datum);
        var w = accessors.w(datum);
        var h = accessors.h(datum);
        var y = yScale(this.y()(datum));

        // handle x position - lock to boundaries
        var targetX = x + dx;
        if (targetX >= xRange[0] && targetX + w <= xRange[1]) {
          x = targetX;
        } else if (targetX < xRange[0]) {
          x = xRange[0];
        } else if (targetX + w > xRange[1]) {
          x = xRange[1] - w;
        }

        // handle y position - lock to boundaries
        var targetY = y - dy;
        var yDisplayed = yRange[1] - h - targetY;

        if (yDisplayed >= yRange[0] && yDisplayed + h <= yRange[1]) {
          y = targetY;
        } else if (yDisplayed < yRange[0]) {
          y = yRange[1] - h;
        } else if (yDisplayed + h > yRange[1]) {
          y = yRange[0];
        }

        var xValue = xScale.invert(x);
        var yValue = yScale.invert(y);

        this.start()(datum, xValue);
        this.y()(datum, yValue);

        this.draw(item);
      },
      writable: true,
      configurable: true
    },
    resizeLeft: {
      value: function resizeLeft(item, dx, dy) {
        item = this.d3.select(item);
        var datum = item.datum();

        var constrains = this.param("edits");
        var canW = !! ~constrains.indexOf("width");
        // early return if cannot edit
        if (!canW) {
          return;
        }

        var accessors = this.getAccessors();
        var xRange = accessors.xScale.range();

        var x = accessors.x(datum);
        var w = accessors.w(datum);

        var targetX = x + dx;
        var targetW = w - dx;

        if (targetX >= xRange[0] && targetW >= this.__minWidth) {
          x = targetX;
          w = targetW;
        }

        var xValue = accessors.xScale.invert(x);
        var minDomain = accessors.xScale.domain()[0];
        var wValue = accessors.xScale.invert(w) - minDomain;

        this.start()(datum, xValue);
        this.duration()(datum, wValue);

        this.draw(item);
      },
      writable: true,
      configurable: true
    },
    resizeRight: {
      value: function resizeRight(item, dx, dy) {
        item = this.d3.select(item);
        var datum = item.datum();

        var constrains = this.param("edits");
        var canW = !! ~constrains.indexOf("width");
        // early return if cannot edit
        if (!canW) {
          return;
        }

        var accessors = this.getAccessors();
        var xRange = accessors.xScale.range();

        var x = accessors.x(datum);
        var w = accessors.w(datum);

        var targetW = w + dx;

        if (targetW >= this.__minWidth && x + targetW <= xRange[1]) {
          w = targetW;
        }

        var minDomain = accessors.xScale.domain()[0];
        var wValue = accessors.xScale.invert(w) - minDomain;
        this.duration()(datum, wValue);

        this.draw(item);
      },
      writable: true,
      configurable: true
    }
  });

  return Segment;
})(Layer);

// add and initialize our accessors
accessors.getFunction(Segment.prototype, ["y", "width", "color", "height", "duration", "start", "sortIndex", "opacity"]);

function factory() {
  return new Segment();
}
factory.Segment = Segment;

module.exports = factory;

// brushItem(extent, mode) {
/*
mode = mode || 'xy'; // default tries to match both
 var modeX = mode.indexOf('x') >= 0;
var modeY = mode.indexOf('y') >= 0;
var matchX = false, matchY = false;
 // data mappers
var start = this.start();
var duration = this.duration();
var y = this.y();
var height = this.height();
 this.g.selectAll('.selectable').classed('selected', (d, i) => {
  // var offsetTop = (that.top() || 0) + (that.base.margin().top || 0);
  // var offsetLeft = (that.left || 0) + (that.base.margin().left || 0);
   // X match
  if (modeX) {
    var x1 = start(d);
    var x2 = x1 + duration(d);
    //            begining sel               end sel
    var matchX1 = extent[0][0] <= x1 && x2 < extent[1][0];
    var matchX2 = extent[0][0] <= x2 && x1 < extent[1][0];
     matchX = (matchX1 || matchX2);
  } else {
    matchX = true;
  }
   // Y match
  if (modeY) {
    var y1 = y(d);
    var y2 = y1 + height(d);
    //            begining sel               end sel
    var matchY1 = extent[0][1] <= y1 && y2 < extent[1][1];
    var matchY2 = extent[0][1] <= y2 && y1 <= extent[1][1];
     matchY = (matchY1 || matchY2);
  } else {
    matchY = true;
  }
   return matchX && matchY;
});
*/
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9oZWxwZXJzL3pvb21lci5lczYuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O2VBRThCLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQzs7SUFBbkQsUUFBUSxZQUFSLFFBQVE7SUFBRSxTQUFTLFlBQVQsU0FBUzs7Z0JBQ1QsT0FBTyxDQUFDLGVBQWUsQ0FBQzs7SUFBbEMsS0FBSyxhQUFMLEtBQUs7O0lBRUwsT0FBTyxjQUFTLEtBQUs7QUFFZCxXQUZQLE9BQU87dUNBQVAsT0FBTzs7QUFHVCxrREFIRSxPQUFPLDZDQUdEOztBQUVSLFFBQUksQ0FBQyxNQUFNLENBQUM7QUFDVixVQUFJLEVBQUUsU0FBUztBQUNmLGFBQU8sRUFBRSxDQUFDO0FBQ1YsV0FBSyxFQUFFLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxPQUFPLEVBQUUsUUFBUSxDQUFDO0FBQ3BDLGtCQUFZLEVBQUUsQ0FBQztBQUNmLG9CQUFjLEVBQUUsQ0FBQztLQUNsQixDQUFDLENBQUM7O0FBRUgsUUFBSSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUM7OztBQUdwQixRQUFJLENBQUMsQ0FBQyxDQUFDLFVBQVMsQ0FBQyxFQUFZO1VBQVYsQ0FBQyxnQ0FBRyxJQUFJOztBQUN6QixVQUFJLENBQUMsS0FBSyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQ2pDLE9BQUMsQ0FBQyxDQUFDLEdBQUksQ0FBQyxDQUFDLEFBQUMsQ0FBQztLQUNaLENBQUMsQ0FBQzs7QUFFSCxRQUFJLENBQUMsTUFBTSxDQUFDLFVBQVMsQ0FBQyxFQUFZO1VBQVYsQ0FBQyxnQ0FBRyxJQUFJOztBQUM5QixVQUFJLENBQUMsS0FBSyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxNQUFNLElBQUksQ0FBQyxDQUFDO0FBQ3RDLE9BQUMsQ0FBQyxNQUFNLEdBQUksQ0FBQyxDQUFDLEFBQUMsQ0FBQztLQUNqQixDQUFDLENBQUM7O0FBRUgsUUFBSSxDQUFD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QyxJQUFJLENBQUMsQ0FBQztPQUNqQjs7Ozs7O1NBeFZHLE9BQU87R0FBUyxLQUFLOzs7QUE2VjNCLFNBQVMsQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxDQUN2QyxHQUFHLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsU0FBUyxDQUM3RSxDQUFDLENBQUM7O0FBRUgsU0FBUyxPQUFPLEdBQUc7QUFBRSxTQUFPLElBQUksT0FBTyxFQUFFLENBQUM7Q0FBRTtBQUM1QyxPQUFPLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQzs7QUFFMUIsTUFBTSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUMiLCJmaWxlIjoic3JjL2hlbHBlcnMvem9vbWVyLmVzNi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIHsgdW5pcXVlSWQsIGFjY2Vzc29ycyB9ID0gcmVxdWlyZSgnLi4vaGVscGVycy91dGlscycpO1xudmFyIHsgTGF5ZXIgfSA9IHJlcXVpcmUoJy4uL2NvcmUvbGF5ZXInKTtcblxuY2xhc3MgU2VnbWVudCBleHRlbmRzIExheWVyIHtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcigpO1xuICAgIC8vIHNldCBsYXllciBkZWZhdWx0c1xuICAgIHRoaXMucGFyYW1zKHtcbiAgICAgIHR5cGU6ICdzZWdtZW50JyxcbiAgICAgIG9wYWNpdHk6IDEsXG4gICAgICBlZGl0czogWyd4JywgJ3knLCAnd2lkdGgnLCAnaGVpZ2h0J10sXG4gICAgICBoYW5kbGVyV2lkdGg6IDIsXG4gICAgICBoYW5kbGVyT3BhY2l0eTogMFxuICAgIH0pO1xuXG4gICAgdGhpcy5fX21pbldpZHRoID0gMTtcblxuICAgIC8vIGluaXRpYWxpemUgZGF0YSBhY2Nlc3NvcnNcbiAgICB0aGlzLnkoZnVuY3Rpb24oZCwgdiA9IG51bGwpIHtcbiAgICAgIGlmICh2ID09PSBudWxsKSByZXR1cm4gK2QueSB8fMKgMDtcbiAgICAgIGQueSA9ICgrdik7XG4gICAgfSk7XG5cbiAgICB0aGlzLmhlaWdodChmdW5jdGlvbihkLCB2ID0gbnVsbCkge1xuICAgICAgaWYgKHYgPT09IG51bGwpIHJldHVybiArZC5oZWlnaHQgfHzCoDE7XG4gICAgICBkLmhlaWdodCA9ICgrdik7XG4gICAgfSk7XG5cbiAgICB0aGlzLmR1cmF0aW9uKGZ1bmN0aW9uKGQsIHYgPSBudWxsKSB7XG4gICAgICBpZiAodiA9PT0gbnVsbCkgcmV0dXJuICtkLmR1cmF0aW9uIHx8wqAxO1xuICAgICAgZC5kdXJhdGlvbiA9ICgrdik7XG4gICAgfSk7XG5cbiAgICB0aGlzLnN0YXJ0KGZ1bmN0aW9uKGQsIHYgPSBudWxsKSB7XG4gICAgICBpZiAodiA9PT0gbnVsbCkgcmV0dXJuICtkLnN0YXJ0IHx8IDA7XG4gICAgICBkLnN0YXJ0ID0gKCt2KTtcbiAgICB9KTtcblxuICAgIHRoaXMuY29sb3IoZnVuY3Rpb24oZCwgdiA9IG51bGwpIHtcbiAgICAgIGlmICh2ID09PSBudWxsKSByZXR1cm4gZC5jb2xvciA/IGQuY29sb3IgKyAnJyA6ICcjMDAwMDAwJztcbiAgICAgIGQuY29sb3IgPSB2ICsgJyc7XG4gICAgfSk7XG5cbiAgICB0aGlzLm9wYWNpdHkoZnVuY3Rpb24oZCwgdiA9IG51bGwpIHtcbiAgICAgIGlmICh2ID09PSBudWxsKSByZXR1cm4gZC5vcGFjaXR5O1xuICAgICAgZC5vcGFjaXR5ID0gdiArICcnO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gQE5PVEUgYWRkIHNvbWUgY2FjaGluZyBzeXN0ZW0gP1xuICBnZXRBY2Nlc3NvcnMoKSB7XG4gICAgLy8gcmV2ZXJzZSB5U2NhbGUgdG8gaGF2ZSBsb2dpY2FsIHNpemVzXG4gICAgLy8gb25seSB5IGlzIHByb2JsZW1hdGljIHRoaXMgd2F5XG4gICAgdmFyIHhTY2FsZSA9IHRoaXMuYmFzZS54U2NhbGU7XG4gICAgdmFyIHlTY2FsZSA9IHRoaXMueVNjYWxlLmNvcHkoKTtcbiAgICB5U2NhbGUucmFuZ2UoeVNjYWxlLnJhbmdlKCkuc2xpY2UoMCkucmV2ZXJzZSgpKTtcbiAgICB2YXIgaGVpZ2h0ID0geVNjYWxlLnJhbmdlKClbMV07XG4gICAgdmFyIG1pbkRvbWFpbiA9IHhTY2FsZS5kb21haW4oKVswXTtcblxuICAgIHZhciBfeCA9IHRoaXMuc3RhcnQoKTtcbiAgICB2YXIgX3kgPSB0aGlzLnkoKTtcbiAgICB2YXIgX3cgPSB0aGlzLmR1cmF0aW9uKCk7XG4gICAgdmFyIF9oID0gdGhpcy5oZWlnaHQoKTtcblxuICAgIHZhciBfY29sb3IgICAgPSB0aGlzLmNvbG9yKCk7XG4gICAgdmFyIF9vcGFjaXR5ICA9IHRoaXMub3BhY2l0eSgpO1xuXG4gICAgLy8gZGVmaW5lIGFjY2Vzb3JzXG4gICAgdmFyIHggPSAoZCkgPT4geyByZXR1cm4geFNjYWxlKF94KGQpKTsgfTtcbiAgICB2YXIgdyA9IChkKSA9PiB7XG4gICAgICB2YXIgd2lkdGggPSB4U2NhbGUobWluRG9tYWluICsgX3coZCkpO1xuICAgICAgcmV0dXJuIHdpZHRoIDwgMCA/IDAgOiB3aWR0aDtcbiAgICB9O1xuICAgIHZhciBoID0gKGQpID0+IHsgcmV0dXJuIHlTY2FsZShfaChkKSk7IH07XG4gICAgdmFyIHkgPSAoZCkgPT4geyByZXR1cm4gaGVpZ2h0IC0gaChkKSAtIHlTY2FsZShfeShkKSk7IH07XG5cbiAgICB2YXIgY29sb3IgPSAoZCkgPT4geyByZXR1cm4gX2NvbG9yKGQpOyB9O1xuICAgIHZhciBvcGFjaXR5ID0gKGQpID0+IHsgcmV0dXJuIChfb3BhY2l0eShkKSB8fMKgdGhpcy5wYXJhbSgnb3BhY2l0eScpKTsgfTtcblxuICAgIHZhciBfaGFuZGxlcldpZHRoID0gcGFyc2VJbnQodGhpcy5wYXJhbSgnaGFuZGxlcldpZHRoJyksIDEwKTtcbiAgICB2YXIgX2hhbGZIYW5kbGVyID0gX2hhbmRsZXJXaWR0aCAqIDAuNTtcblxuICAgIC8vIGhhbmRsZXIgcG9zaXRpb25cbiAgICB2YXIgcmh4ID0gKGQpID0+IHtcbiAgICAgIGxldCB3aWR0aCA9IHcoZCk7XG5cbiAgICAgIHJldHVybiAod2lkdGggPCAoX2hhbmRsZXJXaWR0aCAqIDIpKSA/XG4gICAgICAgIF9oYW5kbGVyV2lkdGggKyB0aGlzLl9fbWluV2lkdGggOiB3aWR0aCAtIF9oYWxmSGFuZGxlcjtcbiAgICB9O1xuXG4gICAgcmV0dXJuIHsgdywgaCwgeCwgeSwgY29sb3IsIG9wYWNpdHksIHhTY2FsZSwgeVNjYWxlLCByaHggfTtcbiAgfVxuXG4gIHVwZGF0ZShkYXRhKSB7XG4gICAgc3VwZXIudXBkYXRlKGRhdGEpO1xuXG4gICAgdGhpcy5pdGVtcyA9IHRoaXMuZy5zZWxlY3RBbGwoJy4nICsgdGhpcy5wYXJhbSgndW5pdENsYXNzJykpXG4gICAgICAuZGF0YSh0aGlzLmRhdGEoKSwgdGhpcy5kYXRhS2V5KCkpO1xuXG4gICAgdmFyIHNlbCA9IHRoaXMuaXRlbXMuZW50ZXIoKVxuICAgICAgLmFwcGVuZCgnZycpXG4gICAgICAuY2xhc3NlZCgnaXRlbScsIHRydWUpXG4gICAgICAuY2xhc3NlZCh0aGlzLnBhcmFtKCd1bml0Q2xhc3MnKSwgdHJ1ZSk7XG5cbiAgICBzZWwuYXBwZW5kKCdyZWN0Jyk7XG5cbiAgICBpZiAodGhpcy5wYXJhbSgnaW50ZXJhY3Rpb25zJykuZWRpdGFibGUpIHtcbiAgICAgIHNlbC5hcHBlbmQoJ2xpbmUnKVxuICAgICAgICAuYXR0cignY2xhc3MnLCAnaGFuZGxlIGxlZnQnKVxuICAgICAgICAuYXR0cignc3Ryb2tlLXdpZHRoJywgdGhpcy5wYXJhbSgnaGFuZGxlcldpZHRoJykpXG4gICAgICAgIC5hdHRyKCdzdHJva2Utb3BhY2l0eScsIHRoaXMucGFyYW0oJ2hhbmRsZXJPcGFjaXR5JykpO1xuXG4gICAgICBzZWwuYXBwZW5kKCdsaW5lJylcbiAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ2hhbmRsZSByaWdodCcpXG4gICAgICAgIC5hdHRyKCdzdHJva2Utd2lkdGgnLCB0aGlzLnBhcmFtKCdoYW5kbGVyV2lkdGgnKSlcbiAgICAgICAgLmF0dHIoJ3N0cm9rZS1vcGFjaXR5JywgdGhpcy5wYXJhbSgnaGFuZGxlck9wYWNpdHknKSk7XG4gICAgfVxuXG4gICAgdGhpcy5pdGVtcy5leGl0KCkucmVtb3ZlKCk7XG4gIH1cblxuICBkcmF3KGVsID0gbnVsbCkge1xuICAgIGVsID0gZWwgfHwgdGhpcy5pdGVtcztcblxuICAgIHZhciBhY2Nlc3NvcnMgPSB0aGlzLmdldEFjY2Vzc29ycygpO1xuXG4gICAgZWwuYXR0cigndHJhbnNmb3JtJywgKGQpID0+IHtcbiAgICAgIHJldHVybiAndHJhbnNsYXRlKCcgKyBhY2Nlc3NvcnMueChkKSArICcsICcgKyBhY2Nlc3NvcnMueShkKSArICcpJztcbiAgICB9KTtcblxuICAgIGVsLnNlbGVjdEFsbCgncmVjdCcpXG4gICAgICAuYXR0cigneCcsIDApXG4gICAgICAuYXR0cigneScsIDApXG4gICAgICAuYXR0cignd2lkdGgnLCBhY2Nlc3NvcnMudylcbiAgICAgIC5hdHRyKCdoZWlnaHQnLCBhY2Nlc3NvcnMuaClcbiAgICAgIC5hdHRyKCdmaWxsJywgYWNjZXNzb3JzLmNvbG9yKVxuICAgICAgLmF0dHIoJ2ZpbGwtb3BhY2l0eScsIGFjY2Vzc29ycy5vcGFjaXR5KTtcblxuICAgIGlmICghIXRoaXMuZWFjaCgpKSB7IGVsLmVhY2godGhpcy5lYWNoKCkpOyB9XG5cbiAgICBpZiAodGhpcy5wYXJhbSgnaW50ZXJhY3Rpb25zJykuZWRpdGFibGUpIHtcblxuICAgICAgdmFyIF9oYW5kbGVyV2lkdGggPSBwYXJzZUludCh0aGlzLnBhcmFtKCdoYW5kbGVyV2lkdGgnKSwgMTApO1xuICAgICAgdmFyIF9oYWxmSGFuZGxlciA9IF9oYW5kbGVyV2lkdGggKiAwLjU7XG5cbiAgICAgIGVsLnNlbGVjdEFsbCgnLmhhbmRsZS5sZWZ0JylcbiAgICAgICAgLmF0dHIoJ3gxJywgX2hhbGZIYW5kbGVyKVxuICAgICAgICAuYXR0cigneDInLCBfaGFsZkhhbmRsZXIpXG4gICAgICAgIC5hdHRyKCd5MScsIDApXG4gICAgICAgIC5hdHRyKCd5MicsIGFjY2Vzc29ycy5oKVxuICAgICAgICAuc3R5bGUoJ3N0cm9rZScsIGFjY2Vzc29ycy5jb2xvcik7XG5cbiAgICAgIGVsLnNlbGVjdEFsbCgnLmhhbmRsZS5yaWdodCcpXG4gICAgICAgIC5hdHRyKCd4MScsIDApXG4gICAgICAgIC5hdHRyKCd4MicsIDApXG4gICAgICAgIC5hdHRyKCd5MScsIDApXG4gICAgICAgIC5hdHRyKCd5MicsIGFjY2Vzc29ycy5oKVxuICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgKGQpID0+IHtcbiAgICAgICAgICByZXR1cm4gJ3RyYW5zbGF0ZSgnICsgYWNjZXNzb3JzLnJoeChkKSArICcsIDApJztcbiAgICAgICAgfSlcbiAgICAgICAgLnN0eWxlKCdzdHJva2UnLCBhY2Nlc3NvcnMuY29sb3IpO1xuICAgIH1cbiAgfVxuXG4gIHhab29tKHZhbCkge1xuICAgIHRoaXMuZHJhdygpO1xuICB9XG5cbiAgLy8gbG9naWMgcGVyZm9ybWVkIHRvIHNlbGVjdCBhbiBpdGVtIGZyb20gdGhlIGJydXNoXG4gIGhhbmRsZUJydXNoKGV4dGVudCwgZSkge1xuICAvLyBicnVzaEl0ZW0oZXh0ZW50LCBtb2RlKSB7XG4gICAgLypcbiAgICBtb2RlID0gbW9kZSB8fCAneHknOyAvLyBkZWZhdWx0IHRyaWVzIHRvIG1hdGNoIGJvdGhcblxuICAgIHZhciBtb2RlWCA9IG1vZGUuaW5kZXhPZigneCcpID49IDA7XG4gICAgdmFyIG1vZGVZID0gbW9kZS5pbmRleE9mKCd5JykgPj0gMDtcbiAgICB2YXIgbWF0Y2hYID0gZmFsc2UsIG1hdGNoWSA9IGZhbHNlO1xuXG4gICAgLy8gZGF0YSBtYXBwZXJzXG4gICAgdmFyIHN0YXJ0ID0gdGhpcy5zdGFydCgpO1xuICAgIHZhciBkdXJhdGlvbiA9IHRoaXMuZHVyYXRpb24oKTtcbiAgICB2YXIgeSA9IHRoaXMueSgpO1xuICAgIHZhciBoZWlnaHQgPSB0aGlzLmhlaWdodCgpO1xuXG4gICAgdGhpcy5nLnNlbGVjdEFsbCgnLnNlbGVjdGFibGUnKS5jbGFzc2VkKCdzZWxlY3RlZCcsIChkLCBpKSA9PiB7XG4gICAgICAvLyB2YXIgb2Zmc2V0VG9wID0gKHRoYXQudG9wKCkgfHwgMCkgKyAodGhhdC5iYXNlLm1hcmdpbigpLnRvcCB8fCAwKTtcbiAgICAgIC8vIHZhciBvZmZzZXRMZWZ0ID0gKHRoYXQubGVmdCB8fCAwKSArICh0aGF0LmJhc2UubWFyZ2luKCkubGVmdCB8fCAwKTtcblxuICAgICAgLy8gWCBtYXRjaFxuICAgICAgaWYgKG1vZGVYKSB7XG4gICAgICAgIHZhciB4MSA9IHN0YXJ0KGQpO1xuICAgICAgICB2YXIgeDIgPSB4MSArIGR1cmF0aW9uKGQpO1xuICAgICAgICAvLyAgICAgICAgICAgIGJlZ2luaW5nIHNlbCAgICAgICAgICAgICAgIGVuZCBzZWxcbiAgICAgICAgdmFyIG1hdGNoWDEgPSBleHRlbnRbMF1bMF0gPD0geDEgJiYgeDIgPCBleHRlbnRbMV1bMF07XG4gICAgICAgIHZhciBtYXRjaFgyID0gZXh0ZW50WzBdWzBdIDw9IHgyICYmIHgxIDwgZXh0ZW50WzFdWzBdO1xuXG4gICAgICAgIG1hdGNoWCA9IChtYXRjaFgxIHx8IG1hdGNoWDIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbWF0Y2hYID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgLy8gWSBtYXRjaFxuICAgICAgaWYgKG1vZGVZKSB7XG4gICAgICAgIHZhciB5MSA9IHkoZCk7XG4gICAgICAgIHZhciB5MiA9IHkxICsgaGVpZ2h0KGQpO1xuICAgICAgICAvLyAgICAgICAgICAgIGJlZ2luaW5nIHNlbCAgICAgICAgICAgICAgIGVuZCBzZWxcbiAgICAgICAgdmFyIG1hdGNoWTEgPSBleHRlbnRbMF1bMV0gPD0geTEgJiYgeTIgPCBleHRlbnRbMV1bMV07XG4gICAgICAgIHZhciBtYXRjaFkyID0gZXh0ZW50WzBdWzFdIDw9IHkyICYmIHkxIDw9IGV4dGVudFsxXVsxXTtcblxuICAgICAgICBtYXRjaFkgPSAobWF0Y2hZMSB8fCBtYXRjaFkyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1hdGNoWSA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBtYXRjaFggJiYgbWF0Y2hZO1xuICAgIH0pO1xuICAgICovXG4gIH1cblxuICBoYW5kbGVEcmFnKGl0ZW0sIGUpIHtcbiAgICBpZiAoaXRlbSA9PT0gbnVsbCkgeyByZXR1cm47IH1cblxuICAgIHZhciBjbGFzc0xpc3QgPSBlLnRhcmdldC5jbGFzc0xpc3Q7XG4gICAgdmFyIG1vZGUgPSAnbW92ZSc7XG4gICAgLy8gaWYgdGhlIHRhcmdldCBpcyBhbiBoYW5kbGVyXG4gICAgaWYgKGNsYXNzTGlzdC5jb250YWlucygnbGVmdCcpKSB7IG1vZGUgPSAncmVzaXplTGVmdCc7IH1cbiAgICBpZiAoY2xhc3NMaXN0LmNvbnRhaW5zKCdyaWdodCcpKSB7IG1vZGUgPSAncmVzaXplUmlnaHQnOyB9XG5cbiAgICB0aGlzW21vZGVdKGl0ZW0sIGUub3JpZ2luYWxFdmVudC5keCwgZS5vcmlnaW5hbEV2ZW50LmR5KTtcbiAgfVxuXG4gIG1vdmUoaXRlbSwgZHgsIGR5KSB7XG4gICAgaXRlbSA9IHRoaXMuZDMuc2VsZWN0KGl0ZW0pO1xuICAgIHZhciBkYXR1bSA9IGl0ZW0uZGF0dW0oKTtcbiAgICAvLyBkZWZpbmUgY29uc3RyYWluc1xuICAgIHZhciBjb25zdHJhaW5zID0gdGhpcy5wYXJhbSgnZWRpdHMnKTtcbiAgICB2YXIgY2FuWCA9ICEhfmNvbnN0cmFpbnMuaW5kZXhPZigneCcpO1xuICAgIHZhciBjYW5ZID0gISF+Y29uc3RyYWlucy5pbmRleE9mKCd5Jyk7XG4gICAgLy8gZWFybHkgcmV0dXJuIGlmIGNhbm5vdCBlZGl0IHggYW5kIHlcbiAgICBpZiAoIWNhblggJiYgIWNhblkpIHsgcmV0dXJuOyB9XG4gICAgLy8gZWxzZSBsb2NrIHRoZSBjb3JyZXNwb25kaW5nIGF4aXNcbiAgICBpZiAoIWNhblgpIHsgZHggPSAwOyB9XG4gICAgaWYgKCFjYW5ZKSB7IGR5ID0gMDsgfVxuXG4gICAgdmFyIGFjY2Vzc29ycyA9IHRoaXMuZ2V0QWNjZXNzb3JzKCk7XG5cbiAgICB2YXIgeFNjYWxlID0gYWNjZXNzb3JzLnhTY2FsZTtcbiAgICB2YXIgeVNjYWxlID0gYWNjZXNzb3JzLnlTY2FsZTtcbiAgICB2YXIgeFJhbmdlID0geFNjYWxlLnJhbmdlKCk7XG4gICAgdmFyIHlSYW5nZSA9IHlTY2FsZS5yYW5nZSgpO1xuXG4gICAgdmFyIHggPSBhY2Nlc3NvcnMueChkYXR1bSk7XG4gICAgdmFyIHcgPSBhY2Nlc3NvcnMudyhkYXR1bSk7XG4gICAgdmFyIGggPSBhY2Nlc3NvcnMuaChkYXR1bSk7XG4gICAgdmFyIHkgPSB5U2NhbGUodGhpcy55KCkoZGF0dW0pKTtcblxuICAgIC8vIGhhbmRsZSB4IHBvc2l0aW9uIC0gbG9jayB0byBib3VuZGFyaWVzXG4gICAgdmFyIHRhcmdldFggPSB4ICsgZHg7XG4gICAgaWYgKHRhcmdldFggPj0geFJhbmdlWzBdICYmICh0YXJnZXRYICsgdykgPD0geFJhbmdlWzFdKSB7XG4gICAgICB4ID0gdGFyZ2V0WDtcbiAgICB9IGVsc2UgaWYgKHRhcmdldFggPCB4UmFuZ2VbMF0pIHtcbiAgICAgIHggPSB4UmFuZ2VbMF07XG4gICAgfSBlbHNlIGlmICgodGFyZ2V0WCArIHcpID4geFJhbmdlWzFdKSB7XG4gICAgICB4ID0geFJhbmdlWzFdIC0gdztcbiAgICB9XG5cbiAgICAvLyBoYW5kbGUgeSBwb3NpdGlvbiAtIGxvY2sgdG8gYm91bmRhcmllc1xuICAgIHZhciB0YXJnZXRZID0geSAtIGR5O1xuICAgIHZhciB5RGlzcGxheWVkID0geVJhbmdlWzFdIC0gaCAtIHRhcmdldFk7XG5cbiAgICBpZiAoeURpc3BsYXllZCA+PSB5UmFuZ2VbMF0gJiYgKHlEaXNwbGF5ZWQgKyBoKSA8PSB5UmFuZ2VbMV0pIHtcbiAgICAgIHkgPSB0YXJnZXRZO1xuICAgIH0gZWxzZSBpZiAoeURpc3BsYXllZCA8IHlSYW5nZVswXSkge1xuICAgICAgeSA9IHlSYW5nZVsxXSAtIGg7XG4gICAgfSBlbHNlIGlmICgoeURpc3BsYXllZCArIGgpID4geVJhbmdlWzFdKSB7XG4gICAgICB5ID0geVJhbmdlWzBdO1xuICAgIH1cblxuICAgIHZhciB4VmFsdWUgPSB4U2NhbGUuaW52ZXJ0KHgpO1xuICAgIHZhciB5VmFsdWUgPSB5U2NhbGUuaW52ZXJ0KHkpO1xuXG4gICAgdGhpcy5zdGFydCgpKGRhdHVtLCB4VmFsdWUpO1xuICAgIHRoaXMueSgpKGRhdHVtLCB5VmFsdWUpO1xuXG4gICAgdGhpcy5kcmF3KGl0ZW0pO1xuICB9XG5cbiAgcmVzaXplTGVmdChpdGVtLCBkeCwgZHkpIHtcbiAgICBpdGVtID0gdGhpcy5kMy5zZWxlY3QoaXRlbSk7XG4gICAgdmFyIGRhdHVtID0gaXRlbS5kYXR1bSgpO1xuXG4gICAgdmFyIGNvbnN0cmFpbnMgPSB0aGlzLnBhcmFtKCdlZGl0cycpO1xuICAgIHZhciBjYW5XID0gISF+Y29uc3RyYWlucy5pbmRleE9mKCd3aWR0aCcpO1xuICAgIC8vIGVhcmx5IHJldHVybiBpZiBjYW5ub3QgZWRpdFxuICAgIGlmICghY2FuVykgeyByZXR1cm47IH1cblxuICAgIHZhciBhY2Nlc3NvcnMgPSB0aGlzLmdldEFjY2Vzc29ycygpO1xuICAgIHZhciB4UmFuZ2UgPSBhY2Nlc3NvcnMueFNjYWxlLnJhbmdlKCk7XG5cbiAgICB2YXIgeCA9IGFjY2Vzc29ycy54KGRhdHVtKTtcbiAgICB2YXIgdyA9IGFjY2Vzc29ycy53KGRhdHVtKTtcblxuICAgIHZhciB0YXJnZXRYID0geCArIGR4O1xuICAgIHZhciB0YXJnZXRXID0gdyAtIGR4O1xuXG4gICAgaWYgKHRhcmdldFggPj0geFJhbmdlWzBdICYmIHRhcmdldFcgPj0gdGhpcy5fX21pbldpZHRoKSB7XG4gICAgICB4ID0gdGFyZ2V0WDtcbiAgICAgIHcgPSB0YXJnZXRXO1xuICAgIH1cblxuICAgIHZhciB4VmFsdWUgPSBhY2Nlc3NvcnMueFNjYWxlLmludmVydCh4KTtcbiAgICB2YXIgbWluRG9tYWluID0gYWNjZXNzb3JzLnhTY2FsZS5kb21haW4oKVswXTtcbiAgICB2YXIgd1ZhbHVlID0gYWNjZXNzb3JzLnhTY2FsZS5pbnZlcnQodykgLSBtaW5Eb21haW47XG5cbiAgICB0aGlzLnN0YXJ0KCkoZGF0dW0sIHhWYWx1ZSk7XG4gICAgdGhpcy5kdXJhdGlvbigpKGRhdHVtLCB3VmFsdWUpO1xuXG4gICAgdGhpcy5kcmF3KGl0ZW0pO1xuICB9XG5cbiAgcmVzaXplUmlnaHQoaXRlbSwgZHgsIGR5KSB7XG4gICAgaXRlbSA9IHRoaXMuZDMuc2VsZWN0KGl0ZW0pO1xuICAgIHZhciBkYXR1bSA9IGl0ZW0uZGF0dW0oKTtcblxuICAgIHZhciBjb25zdHJhaW5zID0gdGhpcy5wYXJhbSgnZWRpdHMnKTtcbiAgICB2YXIgY2FuVyA9ICEhfmNvbnN0cmFpbnMuaW5kZXhPZignd2lkdGgnKTtcbiAgICAvLyBlYXJseSByZXR1cm4gaWYgY2Fubm90IGVkaXRcbiAgICBpZiAoIWNhblcpIHsgcmV0dXJuOyB9XG5cbiAgICB2YXIgYWNjZXNzb3JzID0gdGhpcy5nZXRBY2Nlc3NvcnMoKTtcbiAgICB2YXIgeFJhbmdlID0gYWNjZXNzb3JzLnhTY2FsZS5yYW5nZSgpO1xuXG4gICAgdmFyIHggPSBhY2Nlc3NvcnMueChkYXR1bSk7XG4gICAgdmFyIHcgPSBhY2Nlc3NvcnMudyhkYXR1bSk7XG5cbiAgICB2YXIgdGFyZ2V0VyA9IHcgKyBkeDtcblxuICAgIGlmICh0YXJnZXRXID49IHRoaXMuX19taW5XaWR0aCAmJiAoeCArIHRhcmdldFcpIDw9IHhSYW5nZVsxXSkge1xuICAgICAgdyA9IHRhcmdldFc7XG4gICAgfVxuXG4gICAgdmFyIG1pbkRvbWFpbiA9IGFjY2Vzc29ycy54U2NhbGUuZG9tYWluKClbMF07XG4gICAgdmFyIHdWYWx1ZSA9IGFjY2Vzc29ycy54U2NhbGUuaW52ZXJ0KHcpIC0gbWluRG9tYWluO1xuICAgIHRoaXMuZHVyYXRpb24oKShkYXR1bSwgd1ZhbHVlKTtcblxuICAgIHRoaXMuZHJhdyhpdGVtKTtcbiAgfVxuXG59XG5cbi8vIGFkZCBhbmQgaW5pdGlhbGl6ZSBvdXIgYWNjZXNzb3JzXG5hY2Nlc3NvcnMuZ2V0RnVuY3Rpb24oU2VnbWVudC5wcm90b3R5cGUsIFtcbiAgJ3knLCAnd2lkdGgnLCAnY29sb3InLCAnaGVpZ2h0JywgJ2R1cmF0aW9uJywgJ3N0YXJ0JywgJ3NvcnRJbmRleCcsICdvcGFjaXR5J1xuXSk7XG5cbmZ1bmN0aW9uIGZhY3RvcnkoKSB7IHJldHVybiBuZXcgU2VnbWVudCgpOyB9XG5mYWN0b3J5LlNlZ21lbnQgPSBTZWdtZW50O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGZhY3Rvcnk7XG4iXX0=